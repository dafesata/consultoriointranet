(function(){var e=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},createConsumer:function(e){var t;return e==null&&(e=(t=this.getConfig("url"))!=null?t:this.INTERNAL.default_mount_path),new ActionCable.Consumer(this.createWebSocketURL(e))},getConfig:function(e){var t;return t=document.head.querySelector("meta[name='action-cable-"+e+"']"),t!=null?t.getAttribute("content"):void 0},createWebSocketURL:function(e){var t;return e&&!/^wss?:/i.test(e)?(t=document.createElement("a"),t.href=e,t.href=t.href,t.protocol=t.protocol.replace("http","ws"),t.href):e},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var t;t=1<=arguments.length?e.call(arguments,0):[];if(this.debugging)return t.push(Date.now()),console.log.apply(console,["[ActionCable]"].concat(e.call(t)))}},typeof window!="undefined"&&window!==null&&(window.ActionCable=this.ActionCable),typeof module!="undefined"&&module!==null&&(module.exports=this.ActionCable)}).call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};ActionCable.ConnectionMonitor=function(){function i(t){this.connection=t,this.visibilityDidChange=e(this.visibilityDidChange,this),this.reconnectAttempts=0}var t,n,r;return i.pollInterval={min:3,max:30},i.staleThreshold=6,i.prototype.start=function(){if(!this.isRunning())return this.startedAt=n(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),ActionCable.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},i.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=n(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),ActionCable.log("ConnectionMonitor stopped")},i.prototype.isRunning=function(){return this.startedAt!=null&&this.stoppedAt==null},i.prototype.recordPing=function(){return this.pingedAt=n()},i.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,ActionCable.log("ConnectionMonitor recorded connect")},i.prototype.recordDisconnect=function(){return this.disconnectedAt=n(),ActionCable.log("ConnectionMonitor recorded disconnect")},i.prototype.startPolling=function(){return this.stopPolling(),this.poll()},i.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},i.prototype.poll=function(){return this.pollTimeout=setTimeout(function(e){return function(){return e.reconnectIfStale(),e.poll()}}(this),this.getPollInterval())},i.prototype.getPollInterval=function(){var e,n,r,i;return i=this.constructor.pollInterval,r=i.min,n=i.max,e=5*Math.log(this.reconnectAttempts+1),Math.round(t(e,r,n)*1e3)},i.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return ActionCable.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+r(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?ActionCable.log("ConnectionMonitor skipping reopening recent disconnect"):(ActionCable.log("ConnectionMonitor reopening"),this.connection.reopen())},i.prototype.connectionIsStale=function(){var e;return r((e=this.pingedAt)!=null?e:this.startedAt)>this.constructor.staleThreshold},i.prototype.disconnectedRecently=function(){return this.disconnectedAt&&r(this.disconnectedAt)<this.constructor.staleThreshold},i.prototype.visibilityDidChange=function(){if(document.visibilityState==="visible")return setTimeout(function(e){return function(){if(e.connectionIsStale()||!e.connection.isOpen())return ActionCable.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),e.connection.reopen()}}(this),200)},n=function(){return(new Date).getTime()},r=function(e){return(n()-e)/1e3},t=function(e,t,n){return Math.max(t,Math.min(n,e))},i}()}.call(this),function(){var e,t,n,r,i,s,o=[].slice,u=function(e,t){return function(){return e.apply(t,arguments)}},a=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};r=ActionCable.INTERNAL,t=r.message_types,n=r.protocols,i=2<=n.length?o.call(n,0,e=n.length-1):(e=0,[]),s=n[e++],ActionCable.Connection=function(){function e(e){this.consumer=e,this.open=u(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new ActionCable.ConnectionMonitor(this),this.disconnected=!0}return e.reopenDelay=500,e.prototype.send=function(e){return this.isOpen()?(this.webSocket.send(JSON.stringify(e)),!0):!1},e.prototype.open=function(){if(this.isActive())throw ActionCable.log("Attempted to open WebSocket, but existing socket is "+this.getState()),new Error("Existing connection must be closed before opening");return ActionCable.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+n),this.webSocket!=null&&this.uninstallEventHandlers(),this.webSocket=new WebSocket(this.consumer.url,n),this.installEventHandlers(),this.monitor.start(),!0},e.prototype.close=function(e){var t,n;t=(e!=null?e:{allowReconnect:!0}).allowReconnect,t||this.monitor.stop();if(this.isActive())return(n=this.webSocket)!=null?n.close():void 0},e.prototype.reopen=function(){var e,t;ActionCable.log("Reopening WebSocket, current state is "+this.getState());if(!this.isActive())return this.open();try{return this.close()}catch(t){return e=t,ActionCable.log("Failed to reopen WebSocket",e)}finally{ActionCable.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},e.prototype.getProtocol=function(){var e;return(e=this.webSocket)!=null?e.protocol:void 0},e.prototype.isOpen=function(){return this.isState("open")},e.prototype.isActive=function(){return this.isState("open","connecting")},e.prototype.isProtocolSupported=function(){var e;return e=this.getProtocol(),a.call(i,e)>=0},e.prototype.isState=function(){var e,t;return t=1<=arguments.length?o.call(arguments,0):[],e=this.getState(),a.call(t,e)>=0},e.prototype.getState=function(){var e,t,n;for(t in WebSocket){n=WebSocket[t];if(n===((e=this.webSocket)!=null?e.readyState:void 0))return t.toLowerCase()}return null},e.prototype.installEventHandlers=function(){var e,t;for(e in this.events)t=this.events[e].bind(this),this.webSocket["on"+e]=t},e.prototype.uninstallEventHandlers=function(){var e;for(e in this.events)this.webSocket["on"+e]=function(){}},e.prototype.events={message:function(e){var n,r,i,s;if(!this.isProtocolSupported())return;i=JSON.parse(e.data),n=i.identifier,r=i.message,s=i.type;switch(s){case t.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case t.ping:return this.monitor.recordPing();case t.confirmation:return this.subscriptions.notify(n,"connected");case t.rejection:return this.subscriptions.reject(n);default:return this.subscriptions.notify(n,"received",r)}},open:function(){ActionCable.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1;if(!this.isProtocolSupported())return ActionCable.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(e){ActionCable.log("WebSocket onclose event");if(this.disconnected)return;return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return ActionCable.log("WebSocket onerror event")}},e}()}.call(this),function(){var e=[].slice;ActionCable.Subscriptions=function(){function t(e){this.consumer=e,this.subscriptions=[]}return t.prototype.create=function(e,t){var n,r,i;return n=e,r=typeof n=="object"?n:{channel:n},i=new ActionCable.Subscription(this.consumer,r,t),this.add(i)},t.prototype.add=function(e){return this.subscriptions.push(e),this.consumer.ensureActiveConnection(),this.notify(e,"initialized"),this.sendCommand(e,"subscribe"),e},t.prototype.remove=function(e){return this.forget(e),this.findAll(e.identifier).length||this.sendCommand(e,"unsubscribe"),e},t.prototype.reject=function(e){var t,n,r,i,s;r=this.findAll(e),i=[];for(t=0,n=r.length;t<n;t++)s=r[t],this.forget(s),this.notify(s,"rejected"),i.push(s);return i},t.prototype.forget=function(e){var t;return this.subscriptions=function(){var n,r,i,o;i=this.subscriptions,o=[];for(n=0,r=i.length;n<r;n++)t=i[n],t!==e&&o.push(t);return o}.call(this),e},t.prototype.findAll=function(e){var t,n,r,i,s;r=this.subscriptions,i=[];for(t=0,n=r.length;t<n;t++)s=r[t],s.identifier===e&&i.push(s);return i},t.prototype.reload=function(){var e,t,n,r,i;n=this.subscriptions,r=[];for(e=0,t=n.length;e<t;e++)i=n[e],r.push(this.sendCommand(i,"subscribe"));return r},t.prototype.notifyAll=function(){var t,n,r,i,s,o,u;n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],s=this.subscriptions,o=[];for(r=0,i=s.length;r<i;r++)u=s[r],o.push(this.notify.apply(this,[u,n].concat(e.call(t))));return o},t.prototype.notify=function(){var t,n,r,i,s,o,u;o=arguments[0],n=arguments[1],t=3<=arguments.length?e.call(arguments,2):[],typeof o=="string"?u=this.findAll(o):u=[o],s=[];for(r=0,i=u.length;r<i;r++)o=u[r],s.push(typeof o[n]=="function"?o[n].apply(o,t):void 0);return s},t.prototype.sendCommand=function(e,t){var n;return n=e.identifier,this.consumer.send({command:t,identifier:n})},t}()}.call(this),function(){ActionCable.Subscription=function(){function t(t,n,r){this.consumer=t,n==null&&(n={}),this.identifier=JSON.stringify(n),e(this,r)}var e;return t.prototype.perform=function(e,t){return t==null&&(t={}),t.action=e,this.send(t)},t.prototype.send=function(e){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(e)})},t.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},e=function(e,t){var n,r;if(t!=null)for(n in t)r=t[n],e[n]=r;return e},t}()}.call(this),function(){ActionCable.Consumer=function(){function e(e){this.url=e,this.subscriptions=new ActionCable.Subscriptions(this),this.connection=new ActionCable.Connection(this)}return e.prototype.send=function(e){return this.connection.send(e)},e.prototype.connect=function(){return this.connection.open()},e.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},e.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},e}()}.call(this),function(){this.App||(this.App={}),App.cable=ActionCable.createConsumer()}.call(this);