/*!
 * # Semantic UI - Visibility
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.visibility=function(i){var s=e(this),o=s.selector||"",u=(new Date).getTime(),a=[],f=arguments[0],l=typeof f=="string",c=[].slice.call(arguments,1),h,p=s.length,d=0;return s.each(function(){var s=e.isPlainObject(i)?e.extend(!0,{},e.fn.visibility.settings,i):e.extend({},e.fn.visibility.settings),v=s.className,m=s.namespace,g=s.error,y=s.metadata,b="."+m,w="module-"+m,E=e(t),S=e(this),x=e(s.context),T,N=S.selector||"",C=S.data(w),k=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,0)},L=this,A=!1,O,M,_;_={initialize:function(){_.debug("Initializing",s),_.setup.cache(),_.should.trackChanges()&&(s.type=="image"&&_.setup.image(),s.type=="fixed"&&_.setup.fixed(),s.observeChanges&&_.observeChanges(),_.bind.events()),_.save.position(),_.is.visible()||_.error(g.visible,S),s.initialCheck&&_.checkVisibility(),_.instantiate()},instantiate:function(){_.debug("Storing instance",_),S.data(w,_),C=_},destroy:function(){_.verbose("Destroying previous module"),M&&M.disconnect(),O&&O.disconnect(),E.off("load"+b,_.event.load).off("resize"+b,_.event.resize),x.off("scroll"+b,_.event.scroll).off("scrollchange"+b,_.event.scrollchange),s.type=="fixed"&&(_.resetFixed(),_.remove.placeholder()),S.off(b).removeData(w)},observeChanges:function(){"MutationObserver"in t&&(O=new MutationObserver(_.event.contextChanged),M=new MutationObserver(_.event.changed),O.observe(n,{childList:!0,subtree:!0}),M.observe(L,{childList:!0,subtree:!0}),_.debug("Setting up mutation observer",M))},bind:{events:function(){_.verbose("Binding visibility events to scroll and resize"),s.refreshOnLoad&&E.on("load"+b,_.event.load),E.on("resize"+b,_.event.resize),x.off("scroll"+b).on("scroll"+b,_.event.scroll).on("scrollchange"+b,_.event.scrollchange)}},event:{changed:function(e){_.verbose("DOM tree modified, updating visibility calculations"),_.timer=setTimeout(function(){_.verbose("DOM tree modified, updating sticky menu"),_.refresh()},100)},contextChanged:function(t){[].forEach.call(t,function(t){t.removedNodes&&[].forEach.call(t.removedNodes,function(t){if(t==L||e(t).find(L).length>0)_.debug("Element removed from DOM, tearing down events"),_.destroy()})})},resize:function(){_.debug("Window resized"),s.refreshOnResize&&k(_.refresh)},load:function(){_.debug("Page finished loading"),k(_.refresh)},scroll:function(){s.throttle?(clearTimeout(_.timer),_.timer=setTimeout(function(){x.triggerHandler("scrollchange"+b,[x.scrollTop()])},s.throttle)):k(function(){x.triggerHandler("scrollchange"+b,[x.scrollTop()])})},scrollchange:function(e,t){_.checkVisibility(t)}},precache:function(t,r){t instanceof Array||(t=[t]);var i=t.length,s=0,o=[],u=n.createElement("img"),a=function(){s++,s>=t.length&&e.isFunction(r)&&r()};while(i--)u=n.createElement("img"),u.onload=a,u.onerror=a,u.src=t[i],o.push(u)},enableCallbacks:function(){_.debug("Allowing callbacks to occur"),A=!1},disableCallbacks:function(){_.debug("Disabling all callbacks temporarily"),A=!0},should:{trackChanges:function(){return l?(_.debug("One time query, no need to bind events"),!1):(_.debug("Callbacks being attached"),!0)}},setup:{cache:function(){_.cache={occurred:{},screen:{},element:{}}},image:function(){var e=S.data(y.src);e&&(_.verbose("Lazy loading image",e),s.once=!0,s.observeChanges=!1,s.onOnScreen=function(){_.debug("Image on screen",L),_.precache(e,function(){_.set.image(e,function(){d++,d==p&&s.onAllLoaded.call(this),s.onLoad.call(this)})})})},fixed:function(){_.debug("Setting up fixed"),s.once=!1,s.observeChanges=!1,s.initialCheck=!0,s.refreshOnLoad=!0,i.transition||(s.transition=!1),_.create.placeholder(),_.debug("Added placeholder",T),s.onTopPassed=function(){_.debug("Element passed, adding fixed position",S),_.show.placeholder(),_.set.fixed(),s.transition&&e.fn.transition!==r&&S.transition(s.transition,s.duration)},s.onTopPassedReverse=function(){_.debug("Element returned to position, removing fixed",S),_.hide.placeholder(),_.remove.fixed()}}},create:{placeholder:function(){_.verbose("Creating fixed position placeholder"),T=S.clone(!1).css("display","none").addClass(v.placeholder).insertAfter(S)}},show:{placeholder:function(){_.verbose("Showing placeholder"),T.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){_.verbose("Hiding placeholder"),T.css("display","none").css("visibility","")}},set:{fixed:function(){_.verbose("Setting element to fixed position"),S.addClass(v.fixed).css({position:"fixed",top:s.offset+"px",left:"auto",zIndex:s.zIndex}),s.onFixed.call(L)},image:function(t,n){S.attr("src",t),s.transition?e.fn.transition!==r?S.transition(s.transition,s.duration,n):S.fadeIn(s.duration,n):S.show()}},is:{onScreen:function(){var e=_.get.elementCalculations();return e.onScreen},offScreen:function(){var e=_.get.elementCalculations();return e.offScreen},visible:function(){return _.cache&&_.cache.element?_.cache.element.width!==0||_.cache.element.offset.top!==0:!1}},refresh:function(){_.debug("Refreshing constants (width/height)"),s.type=="fixed"&&_.resetFixed(),_.reset(),_.save.position(),s.checkOnRefresh&&_.checkVisibility(),s.onRefresh.call(L)},resetFixed:function(){_.remove.fixed(),_.remove.occurred()},reset:function(){_.verbose("Resetting all cached values"),e.isPlainObject(_.cache)&&(_.cache.screen={},_.cache.element={})},checkVisibility:function(e){_.verbose("Checking visibility of element",_.cache.element),!A&&_.is.visible()&&(_.save.scroll(e),_.save.calculations(),_.passed(),_.passingReverse(),_.topVisibleReverse(),_.bottomVisibleReverse(),_.topPassedReverse(),_.bottomPassedReverse(),_.onScreen(),_.offScreen(),_.passing(),_.topVisible(),_.bottomVisible(),_.topPassed(),_.bottomPassed(),s.onUpdate&&s.onUpdate.call(L,_.get.elementCalculations()))},passed:function(t,n){var i=_.get.elementCalculations(),o;if(t&&n)s.onPassed[t]=n;else{if(t!==r)return _.get.pixelsPassed(t)>i.pixelsPassed;i.passing&&e.each(s.onPassed,function(e,t){i.bottomVisible||i.pixelsPassed>_.get.pixelsPassed(e)?_.execute(t,e):s.once||_.remove.occurred(t)})}},onScreen:function(e){var t=_.get.elementCalculations(),n=e||s.onOnScreen,i="onScreen";e&&(_.debug("Adding callback for onScreen",e),s.onOnScreen=e),t.onScreen?_.execute(n,i):s.once||_.remove.occurred(i);if(e!==r)return t.onOnScreen},offScreen:function(e){var t=_.get.elementCalculations(),n=e||s.onOffScreen,i="offScreen";e&&(_.debug("Adding callback for offScreen",e),s.onOffScreen=e),t.offScreen?_.execute(n,i):s.once||_.remove.occurred(i);if(e!==r)return t.onOffScreen},passing:function(e){var t=_.get.elementCalculations(),n=e||s.onPassing,i="passing";e&&(_.debug("Adding callback for passing",e),s.onPassing=e),t.passing?_.execute(n,i):s.once||_.remove.occurred(i);if(e!==r)return t.passing},topVisible:function(e){var t=_.get.elementCalculations(),n=e||s.onTopVisible,i="topVisible";e&&(_.debug("Adding callback for top visible",e),s.onTopVisible=e),t.topVisible?_.execute(n,i):s.once||_.remove.occurred(i);if(e===r)return t.topVisible},bottomVisible:function(e){var t=_.get.elementCalculations(),n=e||s.onBottomVisible,i="bottomVisible";e&&(_.debug("Adding callback for bottom visible",e),s.onBottomVisible=e),t.bottomVisible?_.execute(n,i):s.once||_.remove.occurred(i);if(e===r)return t.bottomVisible},topPassed:function(e){var t=_.get.elementCalculations(),n=e||s.onTopPassed,i="topPassed";e&&(_.debug("Adding callback for top passed",e),s.onTopPassed=e),t.topPassed?_.execute(n,i):s.once||_.remove.occurred(i);if(e===r)return t.topPassed},bottomPassed:function(e){var t=_.get.elementCalculations(),n=e||s.onBottomPassed,i="bottomPassed";e&&(_.debug("Adding callback for bottom passed",e),s.onBottomPassed=e),t.bottomPassed?_.execute(n,i):s.once||_.remove.occurred(i);if(e===r)return t.bottomPassed},passingReverse:function(e){var t=_.get.elementCalculations(),n=e||s.onPassingReverse,i="passingReverse";e&&(_.debug("Adding callback for passing reverse",e),s.onPassingReverse=e),t.passing?s.once||_.remove.occurred(i):_.get.occurred("passing")&&_.execute(n,i);if(e!==r)return!t.passing},topVisibleReverse:function(e){var t=_.get.elementCalculations(),n=e||s.onTopVisibleReverse,i="topVisibleReverse";e&&(_.debug("Adding callback for top visible reverse",e),s.onTopVisibleReverse=e),t.topVisible?s.once||_.remove.occurred(i):_.get.occurred("topVisible")&&_.execute(n,i);if(e===r)return!t.topVisible},bottomVisibleReverse:function(e){var t=_.get.elementCalculations(),n=e||s.onBottomVisibleReverse,i="bottomVisibleReverse";e&&(_.debug("Adding callback for bottom visible reverse",e),s.onBottomVisibleReverse=e),t.bottomVisible?s.once||_.remove.occurred(i):_.get.occurred("bottomVisible")&&_.execute(n,i);if(e===r)return!t.bottomVisible},topPassedReverse:function(e){var t=_.get.elementCalculations(),n=e||s.onTopPassedReverse,i="topPassedReverse";e&&(_.debug("Adding callback for top passed reverse",e),s.onTopPassedReverse=e),t.topPassed?s.once||_.remove.occurred(i):_.get.occurred("topPassed")&&_.execute(n,i);if(e===r)return!t.onTopPassed},bottomPassedReverse:function(e){var t=_.get.elementCalculations(),n=e||s.onBottomPassedReverse,i="bottomPassedReverse";e&&(_.debug("Adding callback for bottom passed reverse",e),s.onBottomPassedReverse=e),t.bottomPassed?s.once||_.remove.occurred(i):_.get.occurred("bottomPassed")&&_.execute(n,i);if(e===r)return!t.bottomPassed},execute:function(e,t){var n=_.get.elementCalculations(),r=_.get.screenCalculations();e=e||!1,e&&(s.continuous?(_.debug("Callback being called continuously",t,n),e.call(L,n,r)):_.get.occurred(t)||(_.debug("Conditions met",t,n),e.call(L,n,r))),_.save.occurred(t)},remove:{fixed:function(){_.debug("Removing fixed position"),S.removeClass(v.fixed).css({position:"",top:"",left:"",zIndex:""}),s.onUnfixed.call(L)},placeholder:function(){_.debug("Removing placeholder content"),T&&T.remove()},occurred:function(e){if(e){var t=_.cache.occurred;t[e]!==r&&t[e]===!0&&(_.debug("Callback can now be called again",e),_.cache.occurred[e]=!1)}else _.cache.occurred={}}},save:{calculations:function(){_.verbose("Saving all calculations necessary to determine positioning"),_.save.direction(),_.save.screenCalculations(),_.save.elementCalculations()},occurred:function(e){e&&(_.cache.occurred[e]===r||_.cache.occurred[e]!==!0)&&(_.verbose("Saving callback occurred",e),_.cache.occurred[e]=!0)},scroll:function(e){e=e+s.offset||x.scrollTop()+s.offset,_.cache.scroll=e},direction:function(){var e=_.get.scroll(),t=_.get.lastScroll(),n;return e>t&&t?n="down":e<t&&t?n="up":n="static",_.cache.direction=n,_.cache.direction},elementPosition:function(){var e=_.cache.element,t=_.get.screenSize();return _.verbose("Saving element position"),e.fits=e.height<t.height,e.offset=S.offset(),e.width=S.outerWidth(),e.height=S.outerHeight(),_.cache.element=e,e},elementCalculations:function(){var e=_.get.screenCalculations(),t=_.get.elementPosition();return s.includeMargin?(t.margin={},t.margin.top=parseInt(S.css("margin-top"),10),t.margin.bottom=parseInt(S.css("margin-bottom"),10),t.top=t.offset.top-t.margin.top,t.bottom=t.offset.top+t.height+t.margin.bottom):(t.top=t.offset.top,t.bottom=t.offset.top+t.height),t.topVisible=e.bottom>=t.top,t.topPassed=e.top>=t.top,t.bottomVisible=e.bottom>=t.bottom,t.bottomPassed=e.top>=t.bottom,t.pixelsPassed=0,t.percentagePassed=0,t.onScreen=t.topVisible&&!t.bottomPassed,t.passing=t.topPassed&&!t.bottomPassed,t.offScreen=!t.onScreen,t.passing&&(t.pixelsPassed=e.top-t.top,t.percentagePassed=(e.top-t.top)/t.height),_.cache.element=t,_.verbose("Updated element calculations",t),t},screenCalculations:function(){var e=_.get.scroll();return _.save.direction(),_.cache.screen.top=e,_.cache.screen.bottom=e+_.cache.screen.height,_.cache.screen},screenSize:function(){_.verbose("Saving window position"),_.cache.screen={height:x.height()}},position:function(){_.save.screenSize(),_.save.elementPosition()}},get:{pixelsPassed:function(e){var t=_.get.elementCalculations();return e.search("%")>-1?t.height*(parseInt(e,10)/100):parseInt(e,10)},occurred:function(e){return _.cache.occurred!==r?_.cache.occurred[e]||!1:!1},direction:function(){return _.cache.direction===r&&_.save.direction(),_.cache.direction},elementPosition:function(){return _.cache.element===r&&_.save.elementPosition(),_.cache.element},elementCalculations:function(){return _.cache.element===r&&_.save.elementCalculations(),_.cache.element},screenCalculations:function(){return _.cache.screen===r&&_.save.screenCalculations(),_.cache.screen},screenSize:function(){return _.cache.screen===r&&_.save.screenSize(),_.cache.screen},scroll:function(){return _.cache.scroll===r&&_.save.scroll(),_.cache.scroll},lastScroll:function(){return _.cache.screen===r?(_.debug("First scroll event, no last scroll could be found"),!1):_.cache.screen.top}},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,s,t);else{if(n===r)return s[t];s[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,_,t);else{if(n===r)return _[t];_[t]=n}},debug:function(){!s.silent&&s.debug&&(s.performance?_.performance.log(arguments):(_.debug=Function.prototype.bind.call(console.info,console,s.name+":"),_.debug.apply(console,arguments)))},verbose:function(){!s.silent&&s.verbose&&s.debug&&(s.performance?_.performance.log(arguments):(_.verbose=Function.prototype.bind.call(console.info,console,s.name+":"),_.verbose.apply(console,arguments)))},error:function(){s.silent||(_.error=Function.prototype.bind.call(console.error,console,s.name+":"),_.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;s.performance&&(t=(new Date).getTime(),r=u||t,n=t-r,u=t,a.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:L,"Execution Time":n})),clearTimeout(_.performance.timer),_.performance.timer=setTimeout(_.performance.display,500)},display:function(){var t=s.name+":",n=0;u=!1,clearTimeout(_.performance.timer),e.each(a,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",o&&(t+=" '"+o+"'"),(console.group!==r||console.table!==r)&&a.length>0&&(console.groupCollapsed(t),console.table?console.table(a):e.each(a,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),a=[]}},invoke:function(t,n,i){var s=C,o,u,a;return n=n||c,i=L||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):(_.error(g.method,t),!1);s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(h)?h.push(a):h!==r?h=[h,a]:a!==r&&(h=a),u}},l?(C===r&&_.initialize(),C.save.scroll(),C.save.calculations(),_.invoke(f)):(C!==r&&C.invoke("destroy"),_.initialize())}),h!==r?h:this},e.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:!1,verbose:!1,performance:!0,observeChanges:!0,initialCheck:!0,refreshOnLoad:!0,refreshOnResize:!0,checkOnRefresh:!0,once:!0,continuous:!1,offset:0,includeMargin:!1,context:t,throttle:!1,type:!1,zIndex:"10",transition:"fade in",duration:1e3,onPassed:{},onOnScreen:!1,onOffScreen:!1,onPassing:!1,onTopVisible:!1,onBottomVisible:!1,onTopPassed:!1,onBottomPassed:!1,onPassingReverse:!1,onTopVisibleReverse:!1,onBottomVisibleReverse:!1,onTopPassedReverse:!1,onBottomPassedReverse:!1,onLoad:function(){},onAllLoaded:function(){},onFixed:function(){},onUnfixed:function(){},onUpdate:!1,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"placeholder"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}})(jQuery,window,document);