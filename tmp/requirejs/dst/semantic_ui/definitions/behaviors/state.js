/*!
 * # Semantic UI - State
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.state=function(t){var i=e(this),s=i.selector||"",o="ontouchstart"in n.documentElement,u=(new Date).getTime(),a=[],f=arguments[0],l=typeof f=="string",c=[].slice.call(arguments,1),h;return i.each(function(){var n=e.isPlainObject(t)?e.extend(!0,{},e.fn.state.settings,t):e.extend({},e.fn.state.settings),o=n.error,p=n.metadata,d=n.className,v=n.namespace,m=n.states,g=n.text,y="."+v,b=v+"-module",w=e(this),E=this,S=w.data(b),x;x={initialize:function(){x.verbose("Initializing module"),n.automatic&&x.add.defaults(),n.context&&s!==""?e(n.context).on(s,"mouseenter"+y,x.change.text).on(s,"mouseleave"+y,x.reset.text).on(s,"click"+y,x.toggle.state):w.on("mouseenter"+y,x.change.text).on("mouseleave"+y,x.reset.text).on("click"+y,x.toggle.state),x.instantiate()},instantiate:function(){x.verbose("Storing instance of module",x),S=x,w.data(b,x)},destroy:function(){x.verbose("Destroying previous module",S),w.off(y).removeData(b)},refresh:function(){x.verbose("Refreshing selector cache"),w=e(E)},add:{defaults:function(){var i=t&&e.isPlainObject(t.states)?t.states:{};e.each(n.defaults,function(t,s){x.is[t]!==r&&x.is[t]()&&(x.verbose("Adding default states",t,E),e.extend(n.states,s,i))})}},is:{active:function(){return w.hasClass(d.active)},loading:function(){return w.hasClass(d.loading)},inactive:function(){return!w.hasClass(d.active)},state:function(e){return d[e]===r?!1:w.hasClass(d[e])},enabled:function(){return!w.is(n.filter.active)},disabled:function(){return w.is(n.filter.active)},textEnabled:function(){return!w.is(n.filter.text)},button:function(){return w.is(".button:not(a, .submit)")},input:function(){return w.is("input")},progress:function(){return w.is(".ui.progress")}},allow:function(e){x.debug("Now allowing state",e),m[e]=!0},disallow:function(e){x.debug("No longer allowing",e),m[e]=!1},allows:function(e){return m[e]||!1},enable:function(){w.removeClass(d.disabled)},disable:function(){w.addClass(d.disabled)},setState:function(e){x.allows(e)&&w.addClass(d[e])},removeState:function(e){x.allows(e)&&w.removeClass(d[e])},toggle:{state:function(){var t,i;if(x.allows("active")&&x.is.enabled()){x.refresh();if(e.fn.api!==r){t=w.api("get request"),i=w.api("was cancelled");if(i)x.debug("API Request cancelled by beforesend"),n.activateTest=function(){return!1},n.deactivateTest=function(){return!1};else if(t){x.listenTo(t);return}}x.change.state()}}},listenTo:function(t){x.debug("API request detected, waiting for state signal",t),t&&(g.loading&&x.update.text(g.loading),e.when(t).then(function(){t.state()=="resolved"?(x.debug("API request succeeded"),n.activateTest=function(){return!0},n.deactivateTest=function(){return!0}):(x.debug("API request failed"),n.activateTest=function(){return!1},n.deactivateTest=function(){return!1}),x.change.state()}))},change:{state:function(){x.debug("Determining state change direction"),x.is.inactive()?x.activate():x.deactivate(),n.sync&&x.sync(),n.onChange.call(E)},text:function(){x.is.textEnabled()&&(x.is.disabled()?(x.verbose("Changing text to disabled text",g.hover),x.update.text(g.disabled)):x.is.active()?g.hover?(x.verbose("Changing text to hover text",g.hover),x.update.text(g.hover)):g.deactivate&&(x.verbose("Changing text to deactivating text",g.deactivate),x.update.text(g.deactivate)):g.hover?(x.verbose("Changing text to hover text",g.hover),x.update.text(g.hover)):g.activate&&(x.verbose("Changing text to activating text",g.activate),x.update.text(g.activate)))}},activate:function(){n.activateTest.call(E)&&(x.debug("Setting state to active"),w.addClass(d.active),x.update.text(g.active),n.onActivate.call(E))},deactivate:function(){n.deactivateTest.call(E)&&(x.debug("Setting state to inactive"),w.removeClass(d.active),x.update.text(g.inactive),n.onDeactivate.call(E))},sync:function(){x.verbose("Syncing other buttons to current state"),x.is.active()?i.not(w).state("activate"):i.not(w).state("deactivate")},get:{text:function(){return n.selector.text?w.find(n.selector.text).text():w.html()},textFor:function(e){return g[e]||!1}},flash:{text:function(e,t,r){var i=x.get.text();x.debug("Flashing text message",e,t),e=e||n.text.flash,t=t||n.flashDuration,r=r||function(){},x.update.text(e),setTimeout(function(){x.update.text(i),r.call(E)},t)}},reset:{text:function(){var e=g.active||w.data(p.storedText),t=g.inactive||w.data(p.storedText);x.is.textEnabled()&&(x.is.active()&&e?(x.verbose("Resetting active text",e),x.update.text(e)):t&&(x.verbose("Resetting inactive text",e),x.update.text(t)))}},update:{text:function(e){var t=x.get.text();e&&e!==t?(x.debug("Updating text",e),n.selector.text?w.data(p.storedText,e).find(n.selector.text).text(e):w.data(p.storedText,e).html(e)):x.debug("Text is already set, ignoring update",e)}},setting:function(t,i){x.debug("Changing setting",t,i);if(e.isPlainObject(t))e.extend(!0,n,t);else{if(i===r)return n[t];e.isPlainObject(n[t])?e.extend(!0,n[t],i):n[t]=i}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,x,t);else{if(n===r)return x[t];x[t]=n}},debug:function(){!n.silent&&n.debug&&(n.performance?x.performance.log(arguments):(x.debug=Function.prototype.bind.call(console.info,console,n.name+":"),x.debug.apply(console,arguments)))},verbose:function(){!n.silent&&n.verbose&&n.debug&&(n.performance?x.performance.log(arguments):(x.verbose=Function.prototype.bind.call(console.info,console,n.name+":"),x.verbose.apply(console,arguments)))},error:function(){n.silent||(x.error=Function.prototype.bind.call(console.error,console,n.name+":"),x.error.apply(console,arguments))},performance:{log:function(e){var t,r,i;n.performance&&(t=(new Date).getTime(),i=u||t,r=t-i,u=t,a.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:E,"Execution Time":r})),clearTimeout(x.performance.timer),x.performance.timer=setTimeout(x.performance.display,500)},display:function(){var t=n.name+":",i=0;u=!1,clearTimeout(x.performance.timer),e.each(a,function(e,t){i+=t["Execution Time"]}),t+=" "+i+"ms",s&&(t+=" '"+s+"'"),(console.group!==r||console.table!==r)&&a.length>0&&(console.groupCollapsed(t),console.table?console.table(a):e.each(a,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),a=[]}},invoke:function(t,n,i){var s=S,u,a,f;return n=n||c,i=E||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),u=t.length-1,e.each(t,function(n,i){var f=n!=u?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[f])&&n!=u)s=s[f];else{if(s[f]!==r)return a=s[f],!1;if(!e.isPlainObject(s[i])||n==u)return s[i]!==r?(a=s[i],!1):(x.error(o.method,t),!1);s=s[i]}})),e.isFunction(a)?f=a.apply(i,n):a!==r&&(f=a),e.isArray(h)?h.push(f):h!==r?h=[h,f]:f!==r&&(h=f),a}},l?(S===r&&x.initialize(),x.invoke(f)):(S!==r&&S.invoke("destroy"),x.initialize())}),h!==r?h:this},e.fn.state.settings={name:"State",debug:!1,verbose:!1,namespace:"state",performance:!0,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return!0},deactivateTest:function(){return!0},automatic:!0,sync:!1,flashDuration:1e3,filter:{text:".loading, .disabled",active:".disabled"},context:!1,error:{beforeSend:"The before send function has cancelled state change",method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{active:"active",disabled:"disabled",error:"error",loading:"loading",success:"success",warning:"warning"},selector:{text:!1},defaults:{input:{disabled:!0,loading:!0,active:!0},button:{disabled:!0,loading:!0,active:!0},progress:{active:!0,success:!0,warning:!0,error:!0}},states:{active:!0,disabled:!0,error:!0,loading:!0,success:!0,warning:!0},text:{disabled:!1,flash:!1,hover:!1,active:!1,inactive:!1,activate:!1,deactivate:!1}}})(jQuery,window,document);