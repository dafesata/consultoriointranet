/*!
 * # Semantic UI - Form Validation
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.form=function(t){var i=e(this),s=i.selector||"",o=(new Date).getTime(),u=[],a=arguments[0],f=arguments[1],l=typeof a=="string",c=[].slice.call(arguments,1),h;return i.each(function(){var p=e(this),d=this,v=[],m=!1,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P;P={initialize:function(){P.get.settings(),l?(D===r&&P.instantiate(),P.invoke(a)):(D!==r&&D.invoke("destroy"),P.verbose("Initializing form validation",p,T),P.bindEvents(),P.set.defaults(),P.instantiate())},instantiate:function(){P.verbose("Storing instance of module",P),D=P,p.data(M,P)},destroy:function(){P.verbose("Destroying previous module",D),P.removeEvents(),p.removeData(M)},refresh:function(){P.verbose("Refreshing selector cache"),g=p.find(k.field),y=p.find(k.group),b=p.find(k.message),w=p.find(k.prompt),E=p.find(k.submit),S=p.find(k.clear),x=p.find(k.reset)},submit:function(){P.verbose("Submitting form",p),p.submit()},attachEvents:function(t,n){n=n||"submit",e(t).on("click"+_,function(e){P[n](),e.preventDefault()})},bindEvents:function(){P.verbose("Attaching form events"),p.on("submit"+_,P.validate.form).on("blur"+_,k.field,P.event.field.blur).on("click"+_,k.submit,P.submit).on("click"+_,k.reset,P.reset).on("click"+_,k.clear,P.clear),T.keyboardShortcuts&&p.on("keydown"+_,k.field,P.event.field.keydown),g.each(function(){var t=e(this),n=t.prop("type"),r=P.get.changeEvent(n,t);e(this).on(r+_,P.event.field.change)})},clear:function(){g.each(function(){var t=e(this),n=t.parent(),r=t.closest(y),i=r.find(k.prompt),s=t.data(C.defaultValue)||"",o=n.is(k.uiCheckbox),u=n.is(k.uiDropdown),a=r.hasClass(L.error);a&&(P.verbose("Resetting error on field",r),r.removeClass(L.error),i.remove()),u?(P.verbose("Resetting dropdown value",n,s),n.dropdown("clear")):o?t.prop("checked",!1):(P.verbose("Resetting field value",t,s),t.val(""))})},reset:function(){g.each(function(){var t=e(this),n=t.parent(),i=t.closest(y),s=i.find(k.prompt),o=t.data(C.defaultValue),u=n.is(k.uiCheckbox),a=n.is(k.uiDropdown),f=i.hasClass(L.error);if(o===r)return;f&&(P.verbose("Resetting error on field",i),i.removeClass(L.error),s.remove()),a?(P.verbose("Resetting dropdown value",n,o),n.dropdown("restore defaults")):u?(P.verbose("Resetting checkbox value",n,o),t.prop("checked",o)):(P.verbose("Resetting field value",t,o),t.val(o))})},is:{bracketedRule:function(e){return e.type&&e.type.match(T.regExp.bracket)},empty:function(e){return!e||e.length===0?!0:e.is('input[type="checkbox"]')?!e.is(":checked"):P.is.blank(e)},blank:function(t){return e.trim(t.val())===""},valid:function(){var t=!0;return P.verbose("Checking if form is valid"),e.each(N,function(e,n){P.validate.field(n,e)||(t=!1)}),t}},removeEvents:function(){p.off(_),g.off(_),E.off(_),g.off(_)},event:{field:{keydown:function(t){var n=e(this),r=t.which,i=n.is(k.input),s=n.is(k.checkbox),o=n.closest(k.uiDropdown).length>0,u={enter:13,escape:27};r==u.escape&&(P.verbose("Escape key pressed blurring field"),n.blur()),!t.ctrlKey&&r==u.enter&&i&&!o&&!s&&(m||(n.one("keyup"+_,P.event.field.keyup),P.submit(),P.debug("Enter pressed on input submitting form")),m=!0)},keyup:function(){m=!1},blur:function(t){var n=e(this),r=n.closest(y),i=P.get.validation(n);r.hasClass(L.error)?(P.debug("Revalidating field",n,i),i&&P.validate.field(i)):(T.on=="blur"||T.on=="change")&&i&&P.validate.field(i)},change:function(t){var n=e(this),r=n.closest(y),i=P.get.validation(n);if(T.on=="change"||r.hasClass(L.error)&&T.revalidate)clearTimeout(P.timer),P.timer=setTimeout(function(){P.debug("Revalidating field",n,P.get.validation(n)),P.validate.field(i)},T.delay)}}},get:{ancillaryValue:function(e){return!e.type||!P.is.bracketedRule(e)?!1:e.type.match(T.regExp.bracket)[1]+""},ruleName:function(e){return P.is.bracketedRule(e)?e.type.replace(e.type.match(T.regExp.bracket)[0],""):e.type},changeEvent:function(e,t){return e=="checkbox"||e=="radio"||e=="hidden"||t.is("select")?"change":P.get.inputEvent()},inputEvent:function(){return n.createElement("input").oninput!==r?"input":n.createElement("input").onpropertychange!==r?"propertychange":"keyup"},prompt:function(e,t){var n=P.get.ruleName(e),r=P.get.ancillaryValue(e),i=e.prompt||T.prompt[n]||T.text.unspecifiedRule,s=i.search("{value}")!==-1,o=i.search("{name}")!==-1,u,a,f;if(o||s)a=P.get.field(t.identifier);return s&&(i=i.replace("{value}",a.val())),o&&(u=a.closest(k.group).find("label").eq(0),f=u.length==1?u.text():a.prop("placeholder")||T.text.unspecifiedField,i=i.replace("{name}",f)),i=i.replace("{identifier}",t.identifier),i=i.replace("{ruleValue}",r),e.prompt||P.verbose("Using default validation prompt for type",i,n),i},settings:function(){if(e.isPlainObject(t)){var n=Object.keys(t),i=n.length>0?t[n[0]].identifier!==r&&t[n[0]].rules!==r:!1,s;i?(T=e.extend(!0,{},e.fn.form.settings,f),N=e.extend({},e.fn.form.settings.defaults,t),P.error(T.error.oldSyntax,d),P.verbose("Extending settings from legacy parameters",N,T)):(t.fields&&(s=Object.keys(t.fields),(typeof t.fields[s[0]]=="string"||e.isArray(t.fields[s[0]]))&&e.each(t.fields,function(n,r){typeof r=="string"&&(r=[r]),t.fields[n]={rules:[]},e.each(r,function(e,r){t.fields[n].rules.push({type:r})})})),T=e.extend(!0,{},e.fn.form.settings,t),N=e.extend({},e.fn.form.settings.defaults,T.fields),P.verbose("Extending settings",N,T))}else T=e.fn.form.settings,N=e.fn.form.settings.defaults,P.verbose("Using default form validation",N,T);O=T.namespace,C=T.metadata,k=T.selector,L=T.className,A=T.error,M="module-"+O,_="."+O,D=p.data(M),P.refresh()},field:function(t){return P.verbose("Finding field with identifier",t),g.filter("#"+t).length>0?g.filter("#"+t):g.filter('[name="'+t+'"]').length>0?g.filter('[name="'+t+'"]'):g.filter('[name="'+t+'[]"]').length>0?g.filter('[name="'+t+'[]"]'):g.filter("[data-"+C.validate+'="'+t+'"]').length>0?g.filter("[data-"+C.validate+'="'+t+'"]'):e("<input/>")},fields:function(t){var n=e();return e.each(t,function(e,t){n=n.add(P.get.field(t))}),n},validation:function(t){var n,r;return N?(e.each(N,function(e,i){r=i.identifier||e,P.get.field(r)[0]==t[0]&&(i.identifier=r,n=i)}),n||!1):!1},value:function(e){var t=[],n;return t.push(e),n=P.get.values.call(d,t),n[e]},values:function(t){var n=e.isArray(t)?P.get.fields(t):g,r={};return n.each(function(t,n){var i=e(n),s=i.prop("type"),o=i.prop("name"),u=i.val(),a=i.is(k.checkbox),f=i.is(k.radio),l=o.indexOf("[]")!==-1,c=a?i.is(":checked"):!1;o&&(l?(o=o.replace("[]",""),r[o]||(r[o]=[]),a?c?r[o].push(u||!0):r[o].push(!1):r[o].push(u)):f?c&&(r[o]=u):a?c?r[o]=u||!0:r[o]=!1:r[o]=u)}),r}},has:{field:function(e){return P.verbose("Checking for existence of a field with identifier",e),typeof e!="string"&&P.error(A.identifier,e),g.filter("#"+e).length>0?!0:g.filter('[name="'+e+'"]').length>0?!0:g.filter("[data-"+C.validate+'="'+e+'"]').length>0?!0:!1}},add:{prompt:function(t,n){var i=P.get.field(t),s=i.closest(y),o=s.children(k.prompt),u=o.length!==0;n=typeof n=="string"?[n]:n,P.verbose("Adding field error state",t),s.addClass(L.error),T.inline&&(u||(o=T.templates.prompt(n),o.appendTo(s)),o.html(n[0]),u?P.verbose("Inline errors are disabled, no inline error added",t):T.transition&&e.fn.transition!==r&&p.transition("is supported")?(P.verbose("Displaying error with css transition",T.transition),o.transition(T.transition+" in",T.duration)):(P.verbose("Displaying error with fallback javascript animation"),o.fadeIn(T.duration)))},errors:function(e){P.debug("Adding form error messages",e),P.set.error(),b.html(T.templates.error(e))}},remove:{prompt:function(t){var n=P.get.field(t),i=n.closest(y),s=i.children(k.prompt);i.removeClass(L.error),T.inline&&s.is(":visible")&&(P.verbose("Removing prompt for field",t),T.transition&&e.fn.transition!==r&&p.transition("is supported")?s.transition(T.transition+" out",T.duration,function(){s.remove()}):s.fadeOut(T.duration,function(){s.remove()}))}},set:{success:function(){p.removeClass(L.error).addClass(L.success)},defaults:function(){g.each(function(){var t=e(this),n=t.filter(k.checkbox).length>0,r=n?t.is(":checked"):t.val();t.data(C.defaultValue,r)})},error:function(){p.removeClass(L.success).addClass(L.error)},value:function(e,t){var n={};return n[e]=t,P.set.values.call(d,n)},values:function(t){if(e.isEmptyObject(t))return;e.each(t,function(t,n){var r=P.get.field(t),i=r.parent(),s=e.isArray(n),o=i.is(k.uiCheckbox),u=i.is(k.uiDropdown),a=r.is(k.radio)&&o,f=r.length>0,l;f&&(s&&o?(P.verbose("Selecting multiple",n,r),i.checkbox("uncheck"),e.each(n,function(e,t){l=r.filter('[value="'+t+'"]'),i=l.parent(),l.length>0&&i.checkbox("check")})):a?(P.verbose("Selecting radio value",n,r),r.filter('[value="'+n+'"]').parent(k.uiCheckbox).checkbox("check")):o?(P.verbose("Setting checkbox value",n,i),n===!0?i.checkbox("check"):i.checkbox("uncheck")):u?(P.verbose("Setting dropdown value",n,i),i.dropdown("set selected",n)):(P.verbose("Setting field value",n,r),r.val(n)))})}},validate:{form:function(e,t){var n=P.get.values(),i;if(m)return!1;v=[];if(P.is.valid()){P.debug("Form has no validation errors, submitting"),P.set.success();if(t!==!0)return T.onSuccess.call(d,e,n)}else{P.debug("Form has errors"),P.set.error(),T.inline||P.add.errors(v),p.data("moduleApi")!==r&&e.stopImmediatePropagation();if(t!==!0)return T.onFailure.call(d,v,n)}},field:function(t,n){var i=t.identifier||n,s=P.get.field(i),o=t.depends?P.get.field(t.depends):!1,u=!0,a=[];return t.identifier||(P.debug("Using field name as identifier",i),t.identifier=i),s.prop("disabled")?(P.debug("Field is disabled. Skipping",i),u=!0):t.optional&&P.is.blank(s)?(P.debug("Field is optional and blank. Skipping",i),u=!0):t.depends&&P.is.empty(o)?(P.debug("Field depends on another value that is not present or empty. Skipping",o),u=!0):t.rules!==r&&e.each(t.rules,function(e,n){P.has.field(i)&&!P.validate.rule(t,n)&&(P.debug("Field is invalid",i,n.type),a.push(P.get.prompt(n,t)),u=!1)}),u?(P.remove.prompt(i,a),T.onValid.call(s),!0):(v=v.concat(a),P.add.prompt(i,a),T.onInvalid.call(s,a),!1)},rule:function(t,n){var i=P.get.field(t.identifier),s=n.type,o=i.val(),u=!0,a=P.get.ancillaryValue(n),f=P.get.ruleName(n),l=T.rules[f];if(!e.isFunction(l)){P.error(A.noRule,f);return}return o=o===r||o===""||o===null?"":e.trim(o+""),l.call(i,o,a)}},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,T,t);else{if(n===r)return T[t];T[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,P,t);else{if(n===r)return P[t];P[t]=n}},debug:function(){!T.silent&&T.debug&&(T.performance?P.performance.log(arguments):(P.debug=Function.prototype.bind.call(console.info,console,T.name+":"),P.debug.apply(console,arguments)))},verbose:function(){!T.silent&&T.verbose&&T.debug&&(T.performance?P.performance.log(arguments):(P.verbose=Function.prototype.bind.call(console.info,console,T.name+":"),P.verbose.apply(console,arguments)))},error:function(){T.silent||(P.error=Function.prototype.bind.call(console.error,console,T.name+":"),P.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;T.performance&&(t=(new Date).getTime(),r=o||t,n=t-r,o=t,u.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:d,"Execution Time":n})),clearTimeout(P.performance.timer),P.performance.timer=setTimeout(P.performance.display,500)},display:function(){var t=T.name+":",n=0;o=!1,clearTimeout(P.performance.timer),e.each(u,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",s&&(t+=" '"+s+"'"),i.length>1&&(t+=" ("+i.length+")"),(console.group!==r||console.table!==r)&&u.length>0&&(console.groupCollapsed(t),console.table?console.table(u):e.each(u,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),u=[]}},invoke:function(t,n,i){var s=D,o,u,a;return n=n||c,i=d||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):!1;s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(h)?h.push(a):h!==r?h=[h,a]:a!==r&&(h=a),u}},P.initialize()}),h!==r?h:this},e.fn.form.settings={name:"Form",namespace:"form",debug:!1,verbose:!1,performance:!0,fields:!1,keyboardShortcuts:!0,on:"submit",inline:!1,delay:200,revalidate:!0,transition:"scale",duration:200,onValid:function(){},onInvalid:function(){},onSuccess:function(){return!0},onFailure:function(){return!1},metadata:{defaultValue:"default",validate:"validate"},regExp:{bracket:/\[(.*)\]/i,decimal:/^\d*(\.)\d+/,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,flags:/^\/(.*)\/(.*)?/,integer:/^\-?\d+$/,number:/^\-?\d*(\.\d+)?$/,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i},text:{unspecifiedRule:"Please enter a valid value",unspecifiedField:"This field"},prompt:{empty:"{name} must have a value",checked:"{name} must be checked",email:"{name} must be a valid e-mail",url:"{name} must be a valid url",regExp:"{name} is not formatted correctly",integer:"{name} must be an integer",decimal:"{name} must be a decimal number",number:"{name} must be set to a number",is:'{name} must be "{ruleValue}"',isExactly:'{name} must be exactly "{ruleValue}"',not:'{name} cannot be set to "{ruleValue}"',notExactly:'{name} cannot be set to exactly "{ruleValue}"',contain:'{name} cannot contain "{ruleValue}"',containExactly:'{name} cannot contain exactly "{ruleValue}"',doesntContain:'{name} must contain  "{ruleValue}"',doesntContainExactly:'{name} must contain exactly "{ruleValue}"',minLength:"{name} must be at least {ruleValue} characters",length:"{name} must be at least {ruleValue} characters",exactLength:"{name} must be exactly {ruleValue} characters",maxLength:"{name} cannot be longer than {ruleValue} characters",match:"{name} must match {ruleValue} field",different:"{name} must have a different value than {ruleValue} field",creditCard:"{name} must be a valid credit card number",minCount:"{name} must have at least {ruleValue} choices",exactCount:"{name} must have exactly {ruleValue} choices",maxCount:"{name} must have {ruleValue} or less choices"},selector:{checkbox:'input[type="checkbox"], input[type="radio"]',clear:".clear",field:"input, textarea, select",group:".field",input:"input",message:".error.message",prompt:".prompt.label",radio:'input[type="radio"]',reset:'.reset:not([type="reset"])',submit:'.submit:not([type="submit"])',uiCheckbox:".ui.checkbox",uiDropdown:".ui.dropdown"},className:{error:"error",label:"ui prompt label",pressed:"down",success:"success"},error:{identifier:"You must specify a string identifier for each field",method:"The method you called is not defined.",noRule:"There is no rule matching the one you specified",oldSyntax:"Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically."},templates:{error:function(t){var n='<ul class="list">';return e.each(t,function(e,t){n+="<li>"+t+"</li>"}),n+="</ul>",e(n)},prompt:function(t){return e("<div/>").addClass("ui basic red pointing prompt label").html(t[0])}},rules:{empty:function(t){return!(t===r||""===t||e.isArray(t)&&t.length===0)},checked:function(){return e(this).filter(":checked").length>0},email:function(t){return e.fn.form.settings.regExp.email.test(t)},url:function(t){return e.fn.form.settings.regExp.url.test(t)},regExp:function(t,n){var r=n.match(e.fn.form.settings.regExp.flags),i;return r&&(n=r.length>=2?r[1]:n,i=r.length>=3?r[2]:""),t.match(new RegExp(n,i))},integer:function(t,n){var i=e.fn.form.settings.regExp.integer,s,o,u;return!!n&&["",".."].indexOf(n)===-1&&(n.indexOf("..")==-1?i.test(n)&&(s=o=n-0):(u=n.split("..",2),i.test(u[0])&&(s=u[0]-0),i.test(u[1])&&(o=u[1]-0))),i.test(t)&&(s===r||t>=s)&&(o===r||t<=o)},decimal:function(t){return e.fn.form.settings.regExp.decimal.test(t)},number:function(t){return e.fn.form.settings.regExp.number.test(t)},is:function(e,t){return t=typeof t=="string"?t.toLowerCase():t,e=typeof e=="string"?e.toLowerCase():e,e==t},isExactly:function(e,t){return e==t},not:function(e,t){return e=typeof e=="string"?e.toLowerCase():e,t=typeof t=="string"?t.toLowerCase():t,e!=t},notExactly:function(e,t){return e!=t},contains:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),t.search(new RegExp(n,"i"))!==-1},containsExactly:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),t.search(new RegExp(n))!==-1},doesntContain:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),t.search(new RegExp(n,"i"))===-1},doesntContainExactly:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),t.search(new RegExp(n))===-1},minLength:function(e,t){return e!==r?e.length>=t:!1},length:function(e,t){return e!==r?e.length>=t:!1},exactLength:function(e,t){return e!==r?e.length==t:!1},maxLength:function(e,t){return e!==r?e.length<=t:!1},match:function(t,n){var i=e(this),s;return e('[data-validate="'+n+'"]').length>0?s=e('[data-validate="'+n+'"]').val():e("#"+n).length>0?s=e("#"+n).val():e('[name="'+n+'"]').length>0?s=e('[name="'+n+'"]').val():e('[name="'+n+'[]"]').length>0&&(s=e('[name="'+n+'[]"]')),s!==r?t.toString()==s.toString():!1},different:function(t,n){var i=e(this),s;return e('[data-validate="'+n+'"]').length>0?s=e('[data-validate="'+n+'"]').val():e("#"+n).length>0?s=e("#"+n).val():e('[name="'+n+'"]').length>0?s=e('[name="'+n+'"]').val():e('[name="'+n+'[]"]').length>0&&(s=e('[name="'+n+'[]"]')),s!==r?t.toString()!==s.toString():!1},creditCard:function(t,n){var r={visa:{pattern:/^4/,length:[16]},amex:{pattern:/^3[47]/,length:[15]},mastercard:{pattern:/^5[1-5]/,length:[16]},discover:{pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16]},unionPay:{pattern:/^(62|88)/,length:[16,17,18,19]},jcb:{pattern:/^35(2[89]|[3-8][0-9])/,length:[16]},maestro:{pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19]},dinersClub:{pattern:/^(30[0-5]|^36)/,length:[14]},laser:{pattern:/^(6304|670[69]|6771)/,length:[16,17,18,19]},visaElectron:{pattern:/^(4026|417500|4508|4844|491(3|7))/,length:[16]}},i={},s=!1,o=typeof n=="string"?n.split(","):!1,u,a;if(typeof t!="string"||t.length===0)return;if(o){e.each(o,function(n,o){a=r[o],a&&(i={length:e.inArray(t.length,a.length)!==-1,pattern:t.search(a.pattern)!==-1},i.length&&i.pattern&&(s=!0))});if(!s)return!1}u={number:e.inArray(t.length,r.unionPay.length)!==-1,pattern:t.search(r.unionPay.pattern)!==-1};if(u.number&&u.pattern)return!0;var f=t.length,l=0,c=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],h=0;while(f--)h+=c[l][parseInt(t.charAt(f),10)],l^=1;return h%10===0&&h>0},minCount:function(e,t){return t==0?!0:t==1?e!=="":e.split(",").length>=t},exactCount:function(e,t){return t==0?e==="":t==1?e!==""&&e.search(",")===-1:e.split(",").length==t},maxCount:function(e,t){return t==0?!1:t==1?e.search(",")===-1:e.split(",").length<=t}}}})(jQuery,window,document);