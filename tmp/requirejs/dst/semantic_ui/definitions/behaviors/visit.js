/*!
 * # Semantic UI - Visit
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.visit=e.fn.visit=function(n){var i=e.isFunction(this)?e(t):e(this),s=i.selector||"",o=(new Date).getTime(),u=[],a=arguments[0],f=typeof a=="string",l=[].slice.call(arguments,1),c;return i.each(function(){var h=e.isPlainObject(n)?e.extend(!0,{},e.fn.visit.settings,n):e.extend({},e.fn.visit.settings),p=h.error,d=h.namespace,v="."+d,m=d+"-module",g=e(this),y=e(),b=this,w=g.data(m),E;E={initialize:function(){h.count?E.store(h.key.count,h.count):h.id?E.add.id(h.id):h.increment&&f!=="increment"&&E.increment(),E.add.display(g),E.instantiate()},instantiate:function(){E.verbose("Storing instance of visit module",E),w=E,g.data(m,E)},destroy:function(){E.verbose("Destroying instance"),g.removeData(m)},increment:function(e){var t=E.get.count(),n=+t+1;e?E.add.id(e):(n>h.limit&&!h.surpass&&(n=h.limit),E.debug("Incrementing visits",n),E.store(h.key.count,n))},decrement:function(e){var t=E.get.count(),n=+t-1;e?E.remove.id(e):(E.debug("Removing visit"),E.store(h.key.count,n))},get:{count:function(){return+E.retrieve(h.key.count)||0},idCount:function(e){return e=e||E.get.ids(),e.length},ids:function(e){var t=[];return e=e||E.retrieve(h.key.ids),typeof e=="string"&&(t=e.split(h.delimiter)),E.verbose("Found visited ID list",t),t},storageOptions:function(e){var t={};return h.expires&&(t.expires=h.expires),h.domain&&(t.domain=h.domain),h.path&&(t.path=h.path),t}},has:{visited:function(t,n){var i=!1;return n=n||E.get.ids(),t!==r&&n&&e.each(n,function(e,n){n==t&&(i=!0)}),i}},set:{count:function(e){E.store(h.key.count,e)},ids:function(e){E.store(h.key.ids,e)}},reset:function(){E.store(h.key.count,0),E.store(h.key.ids,null)},add:{id:function(e){var t=E.retrieve(h.key.ids),n=t===r||t===""?e:t+h.delimiter+e;E.has.visited(e)?E.debug("Unique content already visited, not adding visit",e,t):e===r?E.debug("ID is not defined"):(E.debug("Adding visit to unique content",e),E.store(h.key.ids,n)),E.set.count(E.get.idCount())},display:function(t){var n=e(t);n.length>0&&!e.isWindow(n[0])&&(E.debug("Updating visit count for element",n),y=y.length>0?y.add(n):n)}},remove:{id:function(t){var n=E.get.ids(),i=[];t!==r&&n!==r&&(E.debug("Removing visit to unique content",t,n),e.each(n,function(e,n){n!==t&&i.push(n)}),i=i.join(h.delimiter),E.store(h.key.ids,i)),E.set.count(E.get.idCount())}},check:{limit:function(e){e=e||E.get.count(),h.limit&&(e>=h.limit&&(E.debug("Pages viewed exceeded limit, firing callback",e,h.limit),h.onLimit.call(b,e)),E.debug("Limit not reached",e,h.limit),h.onChange.call(b,e)),E.update.display(e)}},update:{display:function(e){e=e||E.get.count(),y.length>0&&(E.debug("Updating displayed view count",y),y.html(e))}},store:function(n,i){var s=E.get.storageOptions(i);if(h.storageMethod=="localstorage"&&t.localStorage!==r)t.localStorage.setItem(n,i),E.debug("Value stored using local storage",n,i);else{if(e.cookie===r){E.error(p.noCookieStorage);return}e.cookie(n,i,s),E.debug("Value stored using cookie",n,i,s)}n==h.key.count&&E.check.limit(i)},retrieve:function(n,i){var s;h.storageMethod=="localstorage"&&t.localStorage!==r?s=t.localStorage.getItem(n):e.cookie!==r?s=e.cookie(n):E.error(p.noCookieStorage);if(s=="undefined"||s=="null"||s===r||s===null)s=r;return s},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,h,t);else{if(n===r)return h[t];h[t]=n}},internal:function(t,n){E.debug("Changing internal",t,n);if(n===r)return E[t];e.isPlainObject(t)?e.extend(!0,E,t):E[t]=n},debug:function(){!h.silent&&h.debug&&(h.performance?E.performance.log(arguments):(E.debug=Function.prototype.bind.call(console.info,console,h.name+":"),E.debug.apply(console,arguments)))},verbose:function(){!h.silent&&h.verbose&&h.debug&&(h.performance?E.performance.log(arguments):(E.verbose=Function.prototype.bind.call(console.info,console,h.name+":"),E.verbose.apply(console,arguments)))},error:function(){h.silent||(E.error=Function.prototype.bind.call(console.error,console,h.name+":"),E.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;h.performance&&(t=(new Date).getTime(),r=o||t,n=t-r,o=t,u.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:b,"Execution Time":n})),clearTimeout(E.performance.timer),E.performance.timer=setTimeout(E.performance.display,500)},display:function(){var t=h.name+":",n=0;o=!1,clearTimeout(E.performance.timer),e.each(u,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",s&&(t+=" '"+s+"'"),i.length>1&&(t+=" ("+i.length+")"),(console.group!==r||console.table!==r)&&u.length>0&&(console.groupCollapsed(t),console.table?console.table(u):e.each(u,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),u=[]}},invoke:function(t,n,i){var s=w,o,u,a;return n=n||l,i=b||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):!1;s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(c)?c.push(a):c!==r?c=[c,a]:a!==r&&(c=a),u}},f?(w===r&&E.initialize(),E.invoke(a)):(w!==r&&w.invoke("destroy"),E.initialize())}),c!==r?c:this},e.fn.visit.settings={name:"Visit",debug:!1,verbose:!1,performance:!0,namespace:"visit",increment:!1,surpass:!1,count:!1,limit:!1,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:!1,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}})(jQuery,window,document);