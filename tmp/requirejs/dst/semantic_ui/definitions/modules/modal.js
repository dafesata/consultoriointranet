/*!
 * # Semantic UI - Modal
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.modal=function(i){var s=e(this),o=e(t),u=e(n),a=e("body"),f=s.selector||"",l=(new Date).getTime(),c=[],h=arguments[0],p=typeof h=="string",d=[].slice.call(arguments,1),v=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,0)},m;return s.each(function(){var s=e.isPlainObject(i)?e.extend(!0,{},e.fn.modal.settings,i):e.extend({},e.fn.modal.settings),g=s.selector,y=s.className,b=s.namespace,w=s.error,E="."+b,S="module-"+b,x=e(this),T=e(s.context),N=x.find(g.close),C,k,L,A,O,M=this,_=x.data(S),D,P,H,B;B={initialize:function(){B.verbose("Initializing dimmer",T),B.create.id(),B.create.dimmer(),B.refreshModals(),B.bind.events(),s.observeChanges&&B.observeChanges(),B.instantiate()},instantiate:function(){B.verbose("Storing instance of modal"),_=B,x.data(S,_)},create:{dimmer:function(){var t={debug:s.debug,dimmerName:"modals",duration:{show:s.duration,hide:s.duration}},n=e.extend(!0,t,s.dimmerSettings);s.inverted&&(n.variation=n.variation!==r?n.variation+" inverted":"inverted");if(e.fn.dimmer===r){B.error(w.dimmer);return}B.debug("Creating dimmer with settings",n),A=T.dimmer(n),s.detachable?(B.verbose("Modal is detachable, moving content into dimmer"),A.dimmer("add content",x)):B.set.undetached(),s.blurring&&A.addClass(y.blurring),O=A.dimmer("get dimmer")},id:function(){P=(Math.random().toString(16)+"000000000").substr(2,8),D="."+P,B.verbose("Creating unique id for element",P)}},destroy:function(){B.verbose("Destroying previous modal"),x.removeData(S).off(E),o.off(D),O.off(D),N.off(E),T.dimmer("destroy")},observeChanges:function(){"MutationObserver"in t&&(H=new MutationObserver(function(e){B.debug("DOM tree modified, refreshing"),B.refresh()}),H.observe(M,{childList:!0,subtree:!0}),B.debug("Setting up mutation observer",H))},refresh:function(){B.remove.scrolling(),B.cacheSizes(),B.set.screenHeight(),B.set.type(),B.set.position()},refreshModals:function(){k=x.siblings(g.modal),C=k.add(x)},attachEvents:function(t,n){var r=e(t);n=e.isFunction(B[n])?B[n]:B.toggle,r.length>0?(B.debug("Attaching modal events to element",t,n),r.off(E).on("click"+E,n)):B.error(w.notFound,t)},bind:{events:function(){B.verbose("Attaching events"),x.on("click"+E,g.close,B.event.close).on("click"+E,g.approve,B.event.approve).on("click"+E,g.deny,B.event.deny),o.on("resize"+D,B.event.resize)}},get:{id:function(){return(Math.random().toString(16)+"000000000").substr(2,8)}},event:{approve:function(){if(s.onApprove.call(M,e(this))===!1){B.verbose("Approve callback returned false cancelling hide");return}B.hide()},deny:function(){if(s.onDeny.call(M,e(this))===!1){B.verbose("Deny callback returned false cancelling hide");return}B.hide()},close:function(){B.hide()},click:function(t){var r=e(t.target),i=r.closest(g.modal).length>0,o=e.contains(n.documentElement,t.target);!i&&o&&(B.debug("Dimmer clicked, hiding all modals"),B.is.active()&&(B.remove.clickaway(),s.allowMultiple?B.hide():B.hideAll()))},debounce:function(e,t){clearTimeout(B.timer),B.timer=setTimeout(e,t)},keyboard:function(e){var t=e.which,n=27;t==n&&(s.closable?(B.debug("Escape key pressed hiding modal"),B.hide()):B.debug("Escape key pressed, but closable is set to false"),e.preventDefault())},resize:function(){A.dimmer("is active")&&v(B.refresh)}},toggle:function(){B.is.active()||B.is.animating()?B.hide():B.show()},show:function(t){t=e.isFunction(t)?t:function(){},B.refreshModals(),B.showModal(t)},hide:function(t){t=e.isFunction(t)?t:function(){},B.refreshModals(),B.hideModal(t)},showModal:function(t){t=e.isFunction(t)?t:function(){},B.is.animating()||!B.is.active()?(B.showDimmer(),B.cacheSizes(),B.set.position(),B.set.screenHeight(),B.set.type(),B.set.clickaway(),!s.allowMultiple&&B.others.active()?B.hideOthers(B.showModal):(s.onShow.call(M),s.transition&&e.fn.transition!==r&&x.transition("is supported")?(B.debug("Showing modal with css animations"),x.transition({debug:s.debug,animation:s.transition+" in",queue:s.queue,duration:s.duration,useFailSafe:!0,onComplete:function(){s.onVisible.apply(M),B.add.keyboardShortcuts(),B.save.focus(),B.set.active(),s.autofocus&&B.set.autofocus(),t()}})):B.error(w.noTransition))):B.debug("Modal is already visible")},hideModal:function(t,n){t=e.isFunction(t)?t:function(){},B.debug("Hiding modal");if(s.onHide.call(M,e(this))===!1){B.verbose("Hide callback returned false cancelling hide");return}if(B.is.animating()||B.is.active())s.transition&&e.fn.transition!==r&&x.transition("is supported")?(B.remove.active(),x.transition({debug:s.debug,animation:s.transition+" out",queue:s.queue,duration:s.duration,useFailSafe:!0,onStart:function(){!B.others.active()&&!n&&B.hideDimmer(),B.remove.keyboardShortcuts()},onComplete:function(){s.onHidden.call(M),B.restore.focus(),t()}})):B.error(w.noTransition)},showDimmer:function(){A.dimmer("is animating")||!A.dimmer("is active")?(B.debug("Showing dimmer"),A.dimmer("show")):B.debug("Dimmer already visible")},hideDimmer:function(){if(!A.dimmer("is animating")&&!A.dimmer("is active")){B.debug("Dimmer is not visible cannot hide");return}A.dimmer("hide",function(){B.remove.clickaway(),B.remove.screenHeight()})},hideAll:function(t){var n=C.filter("."+y.active+", ."+y.animating);t=e.isFunction(t)?t:function(){},n.length>0&&(B.debug("Hiding all visible modals"),B.hideDimmer(),n.modal("hide modal",t))},hideOthers:function(t){var n=k.filter("."+y.active+", ."+y.animating);t=e.isFunction(t)?t:function(){},n.length>0&&(B.debug("Hiding other modals",k),n.modal("hide modal",t,!0))},others:{active:function(){return k.filter("."+y.active).length>0},animating:function(){return k.filter("."+y.animating).length>0}},add:{keyboardShortcuts:function(){B.verbose("Adding keyboard shortcuts"),u.on("keyup"+E,B.event.keyboard)}},save:{focus:function(){L=e(n.activeElement).blur()}},restore:{focus:function(){L&&L.length>0&&L.focus()}},remove:{active:function(){x.removeClass(y.active)},clickaway:function(){s.closable&&O.off("click"+D)},bodyStyle:function(){a.attr("style")===""&&(B.verbose("Removing style attribute"),a.removeAttr("style"))},screenHeight:function(){B.debug("Removing page height"),a.css("height","")},keyboardShortcuts:function(){B.verbose("Removing keyboard shortcuts"),u.off("keyup"+E)},scrolling:function(){A.removeClass(y.scrolling),x.removeClass(y.scrolling)}},cacheSizes:function(){var i=x.outerHeight();if(B.cache===r||i!==0)B.cache={pageHeight:e(n).outerHeight(),height:i+s.offset,contextHeight:s.context=="body"?e(t).height():A.height()};B.debug("Caching modal and container sizes",B.cache)},can:{fit:function(){return B.cache.height+s.padding*2<B.cache.contextHeight}},is:{active:function(){return x.hasClass(y.active)},animating:function(){return x.transition("is supported")?x.transition("is animating"):x.is(":visible")},scrolling:function(){return A.hasClass(y.scrolling)},modernBrowser:function(){return!(t.ActiveXObject||"ActiveXObject"in t)}},set:{autofocus:function(){var e=x.find(":input").filter(":visible"),t=e.filter("[autofocus]"),n=t.length>0?t.first():e.first();n.length>0&&n.focus()},clickaway:function(){s.closable&&O.on("click"+D,B.event.click)},screenHeight:function(){B.can.fit()?a.css("height",""):(B.debug("Modal is taller than page content, resizing page height"),a.css("height",B.cache.height+s.padding*2))},active:function(){x.addClass(y.active)},scrolling:function(){A.addClass(y.scrolling),x.addClass(y.scrolling)},type:function(){B.can.fit()?(B.verbose("Modal fits on screen"),!B.others.active()&&!B.others.animating()&&B.remove.scrolling()):(B.verbose("Modal cannot fit on screen setting to scrolling"),B.set.scrolling())},position:function(){B.verbose("Centering modal on page",B.cache),B.can.fit()?x.css({top:"",marginTop:-(B.cache.height/2)}):x.css({marginTop:"",top:u.scrollTop()})},undetached:function(){A.addClass(y.undetached)}},setting:function(t,n){B.debug("Changing setting",t,n);if(e.isPlainObject(t))e.extend(!0,s,t);else{if(n===r)return s[t];e.isPlainObject(s[t])?e.extend(!0,s[t],n):s[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,B,t);else{if(n===r)return B[t];B[t]=n}},debug:function(){!s.silent&&s.debug&&(s.performance?B.performance.log(arguments):(B.debug=Function.prototype.bind.call(console.info,console,s.name+":"),B.debug.apply(console,arguments)))},verbose:function(){!s.silent&&s.verbose&&s.debug&&(s.performance?B.performance.log(arguments):(B.verbose=Function.prototype.bind.call(console.info,console,s.name+":"),B.verbose.apply(console,arguments)))},error:function(){s.silent||(B.error=Function.prototype.bind.call(console.error,console,s.name+":"),B.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;s.performance&&(t=(new Date).getTime(),r=l||t,n=t-r,l=t,c.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:M,"Execution Time":n})),clearTimeout(B.performance.timer),B.performance.timer=setTimeout(B.performance.display,500)},display:function(){var t=s.name+":",n=0;l=!1,clearTimeout(B.performance.timer),e.each(c,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",f&&(t+=" '"+f+"'"),(console.group!==r||console.table!==r)&&c.length>0&&(console.groupCollapsed(t),console.table?console.table(c):e.each(c,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),c=[]}},invoke:function(t,n,i){var s=_,o,u,a;return n=n||d,i=M||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):!1;s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(m)?m.push(a):m!==r?m=[m,a]:a!==r&&(m=a),u}},p?(_===r&&B.initialize(),B.invoke(h)):(_!==r&&_.invoke("destroy"),B.initialize())}),m!==r?m:this},e.fn.modal.settings={name:"Modal",namespace:"modal",silent:!1,debug:!1,verbose:!1,performance:!0,observeChanges:!1,allowMultiple:!1,detachable:!0,closable:!0,autofocus:!0,inverted:!1,blurring:!1,dimmerSettings:{closable:!1,useCSS:!0},context:"body",queue:!1,duration:500,offset:0,transition:"scale",padding:50,onShow:function(){},onVisible:function(){},onHide:function(){return!0},onHidden:function(){},onApprove:function(){return!0},onDeny:function(){return!0},selector:{close:"> .close",approve:".actions .positive, .actions .approve, .actions .ok",deny:".actions .negative, .actions .deny, .actions .cancel",modal:".ui.modal"},error:{dimmer:"UI Dimmer, a required component is not included in this page",method:"The method you called is not defined.",notFound:"The element you specified could not be found"},className:{active:"active",animating:"animating",blurring:"blurring",scrolling:"scrolling",undetached:"undetached"}}})(jQuery,window,document);