/*!
 * # Semantic UI - Tab
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.tab=function(i){var s=e.isFunction(this)?e(t):e(this),o=s.selector||"",u=(new Date).getTime(),a=[],f=arguments[0],l=typeof f=="string",c=[].slice.call(arguments,1),h=!1,p;return s.each(function(){var d=e.isPlainObject(i)?e.extend(!0,{},e.fn.tab.settings,i):e.extend({},e.fn.tab.settings),v=d.className,m=d.metadata,g=d.selector,y=d.error,b="."+d.namespace,w="module-"+d.namespace,E=e(this),S,x,T={},N=!0,C=0,k=this,L=E.data(w),A,O,M,_;M={initialize:function(){M.debug("Initializing tab menu item",E),M.fix.callbacks(),M.determineTabs(),M.debug("Determining tabs",d.context,x),d.auto&&M.set.auto(),M.bind.events(),d.history&&!h&&(M.initializeHistory(),h=!0),M.instantiate()},instantiate:function(){M.verbose("Storing instance of module",M),L=M,E.data(w,M)},destroy:function(){M.debug("Destroying tabs",E),E.removeData(w).off(b)},bind:{events:function(){e.isWindow(k)||(M.debug("Attaching tab activation events to element",E),E.on("click"+b,M.event.click))}},determineTabs:function(){var t;d.context==="parent"?(E.closest(g.ui).length>0?(t=E.closest(g.ui),M.verbose("Using closest UI element as parent",t)):t=E,S=t.parent(),M.verbose("Determined parent element for creating context",S)):d.context?(S=e(d.context),M.verbose("Using selector for tab context",d.context,S)):S=e("body"),d.childrenOnly?(x=S.children(g.tabs),M.debug("Searching tab context children for tabs",S,x)):(x=S.find(g.tabs),M.debug("Searching tab context for tabs",S,x))},fix:{callbacks:function(){e.isPlainObject(i)&&(i.onTabLoad||i.onTabInit)&&(i.onTabLoad&&(i.onLoad=i.onTabLoad,delete i.onTabLoad,M.error(y.legacyLoad,i.onLoad)),i.onTabInit&&(i.onFirstLoad=i.onTabInit,delete i.onTabInit,M.error(y.legacyInit,i.onFirstLoad)),d=e.extend(!0,{},e.fn.tab.settings,i))}},initializeHistory:function(){M.debug("Initializing page state");if(e.address===r)return M.error(y.state),!1;if(d.historyType=="state"){M.debug("Using HTML5 to manage state");if(d.path===!1)return M.error(y.path),!1;e.address.history(!0).state(d.path)}e.address.bind("change",M.event.history.change)},event:{click:function(t){var n=e(this).data(m.tab);n!==r?(d.history?(M.verbose("Updating page state",t),e.address.value(n)):(M.verbose("Changing tab",t),M.changeTab(n)),t.preventDefault()):M.debug("No tab specified")},history:{change:function(t){var n=t.pathNames.join("/")||M.get.initialPath(),i=d.templates.determineTitle(n)||!1;M.performance.display(),M.debug("History change event",n,t),_=t,n!==r&&M.changeTab(n),i&&e.address.title(i)}}},refresh:function(){A&&(M.debug("Refreshing tab",A),M.changeTab(A))},cache:{read:function(e){return e!==r?T[e]:!1},add:function(e,t){e=e||A,M.debug("Adding cached content for",e),T[e]=t},remove:function(e){e=e||A,M.debug("Removing cached content for",e),delete T[e]}},set:{auto:function(){var t=typeof d.path=="string"?d.path.replace(/\/$/,"")+"/{$tab}":"/{$tab}";M.verbose("Setting up automatic tab retrieval from server",t),e.isPlainObject(d.apiSettings)?d.apiSettings.url=t:d.apiSettings={url:t}},loading:function(e){var t=M.get.tabElement(e),n=t.hasClass(v.loading);n||(M.verbose("Setting loading state for",t),t.addClass(v.loading).siblings(x).removeClass(v.active+" "+v.loading),t.length>0&&d.onRequest.call(t[0],e))},state:function(t){e.address.value(t)}},changeTab:function(n){var r=t.history&&t.history.pushState,i=r&&d.ignoreFirstLoad&&N,s=d.auto||e.isPlainObject(d.apiSettings),o=s&&!i?M.utilities.pathToArray(n):M.get.defaultPathArray(n);n=M.utilities.arrayToPath(o),e.each(o,function(t,r){var u=o.slice(0,t+1),a=M.utilities.arrayToPath(u),f=M.is.tab(a),l=t+1==o.length,c=M.get.tabElement(a),h,p,g,b;M.verbose("Looking for tab",r);if(f){M.verbose("Tab was found",r),A=a,O=M.utilities.filterArray(o,u),l?b=!0:(p=o.slice(0,t+2),g=M.utilities.arrayToPath(p),b=!M.is.tab(g),b&&M.verbose("Tab parameters found",p));if(b&&s)return i?(M.debug("Ignoring remote content on first tab load",a),N=!1,M.cache.add(n,c.html()),M.activate.all(a),d.onFirstLoad.call(c[0],a,O,_),d.onLoad.call(c[0],a,O,_)):(M.activate.navigation(a),M.fetch.content(a,n)),!1;M.debug("Opened local tab",a),M.activate.all(a),M.cache.read(a)||(M.cache.add(a,!0),M.debug("First time tab loaded calling tab init"),d.onFirstLoad.call(c[0],a,O,_)),d.onLoad.call(c[0],a,O,_)}else{if(n.search("/")!=-1||n==="")return M.error(y.missingTab,E,S,a),!1;h=e("#"+n+', a[name="'+n+'"]'),a=h.closest("[data-tab]").data(m.tab),c=M.get.tabElement(a);if(h&&h.length>0&&a)return M.debug("Anchor link used, opening parent tab",c,h),c.hasClass(v.active)||setTimeout(function(){M.scrollTo(h)},0),M.activate.all(a),M.cache.read(a)||(M.cache.add(a,!0),M.debug("First time tab loaded calling tab init"),d.onFirstLoad.call(c[0],a,O,_)),d.onLoad.call(c[0],a,O,_),!1}})},scrollTo:function(t){var r=t&&t.length>0?t.offset().top:!1;r!==!1&&(M.debug("Forcing scroll to an in-page link in a hidden tab",r,t),e(n).scrollTop(r))},update:{content:function(e,t,n){var i=M.get.tabElement(e),s=i[0];n=n!==r?n:d.evaluateScripts,n?(M.debug("Updating HTML and evaluating inline scripts",e,t),i.html(t)):(M.debug("Updating HTML",e,t),s.innerHTML=t)}},fetch:{content:function(t,n){var i=M.get.tabElement(t),s={dataType:"html",encodeParameters:!1,on:"now",cache:d.alwaysRefresh,headers:{"X-Remote":!0},onSuccess:function(e){d.cacheType=="response"&&M.cache.add(n,e),M.update.content(t,e),t==A?(M.debug("Content loaded",t),M.activate.tab(t)):M.debug("Content loaded in background",t),d.onFirstLoad.call(i[0],t,O,_),d.onLoad.call(i[0],t,O,_),d.cacheType!="response"&&M.cache.add(n,i.html())},urlData:{tab:n}},o=i.api("get request")||!1,u=o&&o.state()==="pending",a,f;n=n||t,f=M.cache.read(n),d.cache&&f?(M.activate.tab(t),M.debug("Adding cached content",n),d.evaluateScripts=="once"?M.update.content(t,f,!1):M.update.content(t,f),d.onLoad.call(i[0],t,O,_)):u?(M.set.loading(t),M.debug("Content is already loading",n)):e.api!==r?(a=e.extend(!0,{},d.apiSettings,s),M.debug("Retrieving remote content",n,a),M.set.loading(t),i.api(a)):M.error(y.api)}},activate:{all:function(e){M.activate.tab(e),M.activate.navigation(e)},tab:function(e){var t=M.get.tabElement(e),n=d.deactivate=="siblings"?t.siblings(x):x.not(t),r=t.hasClass(v.active);M.verbose("Showing tab content for",t),r||(t.addClass(v.active),n.removeClass(v.active+" "+v.loading),t.length>0&&d.onVisible.call(t[0],e))},navigation:function(e){var t=M.get.navElement(e),n=d.deactivate=="siblings"?t.siblings(s):s.not(t),r=t.hasClass(v.active);M.verbose("Activating tab navigation for",t,e),r||(t.addClass(v.active),n.removeClass(v.active+" "+v.loading))}},deactivate:{all:function(){M.deactivate.navigation(),M.deactivate.tabs()},navigation:function(){s.removeClass(v.active)},tabs:function(){x.removeClass(v.active+" "+v.loading)}},is:{tab:function(e){return e!==r?M.get.tabElement(e).length>0:!1}},get:{initialPath:function(){return s.eq(0).data(m.tab)||x.eq(0).data(m.tab)},path:function(){return e.address.value()},defaultPathArray:function(e){return M.utilities.pathToArray(M.get.defaultPath(e))},defaultPath:function(e){var t=s.filter("[data-"+m.tab+'^="'+e+'/"]').eq(0),n=t.data(m.tab)||!1;if(n){M.debug("Found default tab",n);if(C<d.maxDepth)return C++,M.get.defaultPath(n);M.error(y.recursion)}else M.debug("No default tabs found for",e,x);return C=0,e},navElement:function(e){return e=e||A,s.filter("[data-"+m.tab+'="'+e+'"]')},tabElement:function(e){var t,n,r,i;return e=e||A,r=M.utilities.pathToArray(e),i=M.utilities.last(r),t=x.filter("[data-"+m.tab+'="'+e+'"]'),n=x.filter("[data-"+m.tab+'="'+i+'"]'),t.length>0?t:n},tab:function(){return A}},utilities:{filterArray:function(t,n){return e.grep(t,function(t){return e.inArray(t,n)==-1})},last:function(t){return e.isArray(t)?t[t.length-1]:!1},pathToArray:function(e){return e===r&&(e=A),typeof e=="string"?e.split("/"):[e]},arrayToPath:function(t){return e.isArray(t)?t.join("/"):!1}},setting:function(t,n){M.debug("Changing setting",t,n);if(e.isPlainObject(t))e.extend(!0,d,t);else{if(n===r)return d[t];e.isPlainObject(d[t])?e.extend(!0,d[t],n):d[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,M,t);else{if(n===r)return M[t];M[t]=n}},debug:function(){!d.silent&&d.debug&&(d.performance?M.performance.log(arguments):(M.debug=Function.prototype.bind.call(console.info,console,d.name+":"),M.debug.apply(console,arguments)))},verbose:function(){!d.silent&&d.verbose&&d.debug&&(d.performance?M.performance.log(arguments):(M.verbose=Function.prototype.bind.call(console.info,console,d.name+":"),M.verbose.apply(console,arguments)))},error:function(){d.silent||(M.error=Function.prototype.bind.call(console.error,console,d.name+":"),M.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;d.performance&&(t=(new Date).getTime(),r=u||t,n=t-r,u=t,a.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:k,"Execution Time":n})),clearTimeout(M.performance.timer),M.performance.timer=setTimeout(M.performance.display,500)},display:function(){var t=d.name+":",n=0;u=!1,clearTimeout(M.performance.timer),e.each(a,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",o&&(t+=" '"+o+"'"),(console.group!==r||console.table!==r)&&a.length>0&&(console.groupCollapsed(t),console.table?console.table(a):e.each(a,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),a=[]}},invoke:function(t,n,i){var s=L,o,u,a;return n=n||c,i=k||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):(M.error(y.method,t),!1);s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(p)?p.push(a):p!==r?p=[p,a]:a!==r&&(p=a),u}},l?(L===r&&M.initialize(),M.invoke(f)):(L!==r&&L.invoke("destroy"),M.initialize())}),p!==r?p:this},e.tab=function(){e(t).tab.apply(this,arguments)},e.fn.tab.settings={name:"Tab",namespace:"tab",silent:!1,debug:!1,verbose:!1,performance:!0,auto:!1,history:!1,historyType:"hash",path:!1,context:!1,childrenOnly:!1,maxDepth:25,deactivate:"siblings",alwaysRefresh:!1,cache:!0,cacheType:"response",ignoreFirstLoad:!1,apiSettings:!1,evaluateScripts:"once",onFirstLoad:function(e,t,n){},onLoad:function(e,t,n){},onVisible:function(e,t,n){},onRequest:function(e,t,n){},templates:{determineTitle:function(e){}},error:{api:"You attempted to load content without API module",method:"The method you called is not defined",missingTab:"Activated tab cannot be found. Tabs are case-sensitive.",noContent:"The tab you specified is missing a content url.",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached",legacyInit:"onTabInit has been renamed to onFirstLoad in 2.0, please adjust your code.",legacyLoad:"onTabLoad has been renamed to onLoad in 2.0. Please adjust your code",state:"History requires Asual's Address library <https://github.com/asual/jquery-address>"},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".ui.tab",ui:".ui"}}})(jQuery,window,document);