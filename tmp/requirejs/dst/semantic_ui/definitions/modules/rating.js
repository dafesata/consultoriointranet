/*!
 * # Semantic UI - Rating
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.rating=function(t){var n=e(this),i=n.selector||"",s=(new Date).getTime(),o=[],u=arguments[0],a=typeof u=="string",f=[].slice.call(arguments,1),l;return n.each(function(){var c=e.isPlainObject(t)?e.extend(!0,{},e.fn.rating.settings,t):e.extend({},e.fn.rating.settings),h=c.namespace,p=c.className,d=c.metadata,v=c.selector,m=c.error,g="."+h,y="module-"+h,b=this,w=e(this).data(y),E=e(this),S=E.find(v.icon),x,T;T={initialize:function(){T.verbose("Initializing rating module",c),S.length===0&&T.setup.layout(),c.interactive?T.enable():T.disable(),T.set.initialLoad(),T.set.rating(T.get.initialRating()),T.remove.initialLoad(),T.instantiate()},instantiate:function(){T.verbose("Instantiating module",c),w=T,E.data(y,T)},destroy:function(){T.verbose("Destroying previous instance",w),T.remove.events(),E.removeData(y)},refresh:function(){S=E.find(v.icon)},setup:{layout:function(){var t=T.get.maxRating(),n=e.fn.rating.settings.templates.icon(t);T.debug("Generating icon html dynamically"),E.html(n),T.refresh()}},event:{mouseenter:function(){var t=e(this);t.nextAll().removeClass(p.selected),E.addClass(p.selected),t.addClass(p.selected).prevAll().addClass(p.selected)},mouseleave:function(){E.removeClass(p.selected),S.removeClass(p.selected)},click:function(){var t=e(this),n=T.get.rating(),r=S.index(t)+1,i=c.clearable=="auto"?S.length===1:c.clearable;i&&n==r?T.clearRating():T.set.rating(r)}},clearRating:function(){T.debug("Clearing current rating"),T.set.rating(0)},bind:{events:function(){T.verbose("Binding events"),E.on("mouseenter"+g,v.icon,T.event.mouseenter).on("mouseleave"+g,v.icon,T.event.mouseleave).on("click"+g,v.icon,T.event.click)}},remove:{events:function(){T.verbose("Removing events"),E.off(g)},initialLoad:function(){x=!1}},enable:function(){T.debug("Setting rating to interactive mode"),T.bind.events(),E.removeClass(p.disabled)},disable:function(){T.debug("Setting rating to read-only mode"),T.remove.events(),E.addClass(p.disabled)},is:{initialLoad:function(){return x}},get:{initialRating:function(){return E.data(d.rating)!==r?(E.removeData(d.rating),E.data(d.rating)):c.initialRating},maxRating:function(){return E.data(d.maxRating)!==r?(E.removeData(d.maxRating),E.data(d.maxRating)):c.maxRating},rating:function(){var e=S.filter("."+p.active).length;return T.verbose("Current rating retrieved",e),e}},set:{rating:function(e){var t=e-1>=0?e-1:0,n=S.eq(t);E.removeClass(p.selected),S.removeClass(p.selected).removeClass(p.active),e>0&&(T.verbose("Setting current rating to",e),n.prevAll().addBack().addClass(p.active)),T.is.initialLoad()||c.onRate.call(b,e)},initialLoad:function(){x=!0}},setting:function(t,n){T.debug("Changing setting",t,n);if(e.isPlainObject(t))e.extend(!0,c,t);else{if(n===r)return c[t];e.isPlainObject(c[t])?e.extend(!0,c[t],n):c[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,T,t);else{if(n===r)return T[t];T[t]=n}},debug:function(){!c.silent&&c.debug&&(c.performance?T.performance.log(arguments):(T.debug=Function.prototype.bind.call(console.info,console,c.name+":"),T.debug.apply(console,arguments)))},verbose:function(){!c.silent&&c.verbose&&c.debug&&(c.performance?T.performance.log(arguments):(T.verbose=Function.prototype.bind.call(console.info,console,c.name+":"),T.verbose.apply(console,arguments)))},error:function(){c.silent||(T.error=Function.prototype.bind.call(console.error,console,c.name+":"),T.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;c.performance&&(t=(new Date).getTime(),r=s||t,n=t-r,s=t,o.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:b,"Execution Time":n})),clearTimeout(T.performance.timer),T.performance.timer=setTimeout(T.performance.display,500)},display:function(){var t=c.name+":",u=0;s=!1,clearTimeout(T.performance.timer),e.each(o,function(e,t){u+=t["Execution Time"]}),t+=" "+u+"ms",i&&(t+=" '"+i+"'"),n.length>1&&(t+=" ("+n.length+")"),(console.group!==r||console.table!==r)&&o.length>0&&(console.groupCollapsed(t),console.table?console.table(o):e.each(o,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),o=[]}},invoke:function(t,n,i){var s=w,o,u,a;return n=n||f,i=b||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):!1;s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(l)?l.push(a):l!==r?l=[l,a]:a!==r&&(l=a),u}},a?(w===r&&T.initialize(),T.invoke(u)):(w!==r&&w.invoke("destroy"),T.initialize())}),l!==r?l:this},e.fn.rating.settings={name:"Rating",namespace:"rating",slent:!1,debug:!1,verbose:!1,performance:!0,initialRating:0,interactive:!0,maxRating:4,clearable:"auto",fireOnInit:!1,onRate:function(e){},error:{method:"The method you called is not defined",noMaximum:"No maximum rating specified. Cannot generate HTML automatically"},metadata:{rating:"rating",maxRating:"maxRating"},className:{active:"active",disabled:"disabled",selected:"selected",loading:"loading"},selector:{icon:".icon"},templates:{icon:function(e){var t=1,n="";while(t<=e)n+='<i class="icon"></i>',t++;return n}}}})(jQuery,window,document);