/*!
 * # Semantic UI - Sticky
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.sticky=function(i){var s=e(this),o=s.selector||"",u=(new Date).getTime(),a=[],f=arguments[0],l=typeof f=="string",c=[].slice.call(arguments,1),h;return s.each(function(){var s=e.isPlainObject(i)?e.extend(!0,{},e.fn.sticky.settings,i):e.extend({},e.fn.sticky.settings),p=s.className,d=s.namespace,v=s.error,m="."+d,g="module-"+d,y=e(this),b=e(t),w=e(s.scrollContext),E,S,x=y.selector||"",T=y.data(g),N=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,0)},C=this,k,L,A;A={initialize:function(){A.determineContainer(),A.determineContext(),A.verbose("Initializing sticky",s,E),A.save.positions(),A.checkErrors(),A.bind.events(),s.observeChanges&&A.observeChanges(),A.instantiate()},instantiate:function(){A.verbose("Storing instance of module",A),T=A,y.data(g,A)},destroy:function(){A.verbose("Destroying previous instance"),A.reset(),k&&k.disconnect(),L&&L.disconnect(),b.off("load"+m,A.event.load).off("resize"+m,A.event.resize),w.off("scrollchange"+m,A.event.scrollchange),y.removeData(g)},observeChanges:function(){"MutationObserver"in t&&(k=new MutationObserver(A.event.documentChanged),L=new MutationObserver(A.event.changed),k.observe(n,{childList:!0,subtree:!0}),L.observe(C,{childList:!0,subtree:!0}),L.observe(S[0],{childList:!0,subtree:!0}),A.debug("Setting up mutation observer",L))},determineContainer:function(){E=y.offsetParent()},determineContext:function(){s.context?S=e(s.context):S=E;if(S.length===0){A.error(v.invalidContext,s.context,y);return}},checkErrors:function(){A.is.hidden()&&A.error(v.visible,y);if(A.cache.element.height>A.cache.context.height){A.reset(),A.error(v.elementSize,y);return}},bind:{events:function(){b.on("load"+m,A.event.load).on("resize"+m,A.event.resize),w.off("scroll"+m).on("scroll"+m,A.event.scroll).on("scrollchange"+m,A.event.scrollchange)}},event:{changed:function(e){clearTimeout(A.timer),A.timer=setTimeout(function(){A.verbose("DOM tree modified, updating sticky menu",e),A.refresh()},100)},documentChanged:function(t){[].forEach.call(t,function(t){t.removedNodes&&[].forEach.call(t.removedNodes,function(t){if(t==C||e(t).find(C).length>0)A.debug("Element removed from DOM, tearing down events"),A.destroy()})})},load:function(){A.verbose("Page contents finished loading"),N(A.refresh)},resize:function(){A.verbose("Window resized"),N(A.refresh)},scroll:function(){N(function(){w.triggerHandler("scrollchange"+m,w.scrollTop())})},scrollchange:function(e,t){A.stick(t),s.onScroll.call(C)}},refresh:function(e){A.reset(),s.context||A.determineContext(),e&&A.determineContainer(),A.save.positions(),A.stick(),s.onReposition.call(C)},supports:{sticky:function(){var t=e("<div/>"),n=t[0];return t.addClass(p.supported),t.css("position").match("sticky")}},save:{lastScroll:function(e){A.lastScroll=e},elementScroll:function(e){A.elementScroll=e},positions:function(){var e={height:w.height()},t={margin:{top:parseInt(y.css("margin-top"),10),bottom:parseInt(y.css("margin-bottom"),10)},offset:y.offset(),width:y.outerWidth(),height:y.outerHeight()},n={offset:S.offset(),height:S.outerHeight()},r={height:E.outerHeight()};A.is.standardScroll()||(A.debug("Non-standard scroll. Removing scroll offset from element offset"),e.top=w.scrollTop(),e.left=w.scrollLeft(),t.offset.top+=e.top,n.offset.top+=e.top,t.offset.left+=e.left,n.offset.left+=e.left),A.cache={fits:t.height<e.height,scrollContext:{height:e.height},element:{margin:t.margin,top:t.offset.top-t.margin.top,left:t.offset.left,width:t.width,height:t.height,bottom:t.offset.top+t.height},context:{top:n.offset.top,height:n.height,bottom:n.offset.top+n.height}},A.set.containerSize(),A.set.size(),A.stick(),A.debug("Caching element positions",A.cache)}},get:{direction:function(e){var t="down";return e=e||w.scrollTop(),A.lastScroll!==r&&(A.lastScroll<e?t="down":A.lastScroll>e&&(t="up")),t},scrollChange:function(e){return e=e||w.scrollTop(),A.lastScroll?e-A.lastScroll:0},currentElementScroll:function(){return A.elementScroll?A.elementScroll:A.is.top()?Math.abs(parseInt(y.css("top"),10))||0:Math.abs(parseInt(y.css("bottom"),10))||0},elementScroll:function(e){e=e||w.scrollTop();var t=A.cache.element,n=A.cache.scrollContext,r=A.get.scrollChange(e),i=t.height-n.height+s.offset,o=A.get.currentElementScroll(),u=o+r;return A.cache.fits||u<0?o=0:u>i?o=i:o=u,o}},remove:{lastScroll:function(){delete A.lastScroll},elementScroll:function(e){delete A.elementScroll},offset:function(){y.css("margin-top","")}},set:{offset:function(){A.verbose("Setting offset on element",s.offset),y.css("margin-top",s.offset)},containerSize:function(){var e=E.get(0).tagName;e==="HTML"||e=="body"?A.determineContainer():Math.abs(E.outerHeight()-A.cache.context.height)>s.jitter&&(A.debug("Context has padding, specifying exact height for container",A.cache.context.height),E.css({height:A.cache.context.height}))},minimumSize:function(){var e=A.cache.element;E.css("min-height",e.height)},scroll:function(e){A.debug("Setting scroll on element",e);if(A.elementScroll==e)return;A.is.top()&&y.css("bottom","").css("top",-e),A.is.bottom()&&y.css("top","").css("bottom",e)},size:function(){A.cache.element.height!==0&&A.cache.element.width!==0&&(C.style.setProperty("width",A.cache.element.width+"px","important"),C.style.setProperty("height",A.cache.element.height+"px","important"))}},is:{standardScroll:function(){return w[0]==t},top:function(){return y.hasClass(p.top)},bottom:function(){return y.hasClass(p.bottom)},initialPosition:function(){return!A.is.fixed()&&!A.is.bound()},hidden:function(){return!y.is(":visible")},bound:function(){return y.hasClass(p.bound)},fixed:function(){return y.hasClass(p.fixed)}},stick:function(e){var t=e||w.scrollTop(),n=A.cache,r=n.fits,i=n.element,o=n.scrollContext,u=n.context,a=A.is.bottom()&&s.pushing?s.bottomOffset:s.offset,e={top:t+a,bottom:t+a+o.height},f=A.get.direction(e.top),l=r?0:A.get.elementScroll(e.top),c=!r,h=i.height!==0;h&&(A.is.initialPosition()?e.top>=u.bottom?(A.debug("Initial element position is bottom of container"),A.bindBottom()):e.top>i.top&&(i.height+e.top-l>=u.bottom?(A.debug("Initial element position is bottom of container"),A.bindBottom()):(A.debug("Initial element position is fixed"),A.fixTop())):A.is.fixed()?A.is.top()?e.top<=i.top?(A.debug("Fixed element reached top of container"),A.setInitialPosition()):i.height+e.top-l>=u.bottom?(A.debug("Fixed element reached bottom of container"),A.bindBottom()):c&&(A.set.scroll(l),A.save.lastScroll(e.top),A.save.elementScroll(l)):A.is.bottom()&&(e.bottom-i.height<=i.top?(A.debug("Bottom fixed rail has reached top of container"),A.setInitialPosition()):e.bottom>=u.bottom?(A.debug("Bottom fixed rail has reached bottom of container"),A.bindBottom()):c&&(A.set.scroll(l),A.save.lastScroll(e.top),A.save.elementScroll(l))):A.is.bottom()&&(e.top<=i.top?(A.debug("Jumped from bottom fixed to top fixed, most likely used home/end button"),A.setInitialPosition()):s.pushing?A.is.bound()&&e.bottom<=u.bottom&&(A.debug("Fixing bottom attached element to bottom of browser."),A.fixBottom()):A.is.bound()&&e.top<=u.bottom-i.height&&(A.debug("Fixing bottom attached element to top of browser."),A.fixTop())))},bindTop:function(){A.debug("Binding element to top of parent container"),A.remove.offset(),y.css({left:"",top:"",marginBottom:""}).removeClass(p.fixed).removeClass(p.bottom).addClass(p.bound).addClass(p.top),s.onTop.call(C),s.onUnstick.call(C)},bindBottom:function(){A.debug("Binding element to bottom of parent container"),A.remove.offset(),y.css({left:"",top:""}).removeClass(p.fixed).removeClass(p.top).addClass(p.bound).addClass(p.bottom),s.onBottom.call(C),s.onUnstick.call(C)},setInitialPosition:function(){A.debug("Returning to initial position"),A.unfix(),A.unbind()},fixTop:function(){A.debug("Fixing element to top of page"),A.set.minimumSize(),A.set.offset(),y.css({left:A.cache.element.left,bottom:"",marginBottom:""}).removeClass(p.bound).removeClass(p.bottom).addClass(p.fixed).addClass(p.top),s.onStick.call(C)},fixBottom:function(){A.debug("Sticking element to bottom of page"),A.set.minimumSize(),A.set.offset(),y.css({left:A.cache.element.left,bottom:"",marginBottom:""}).removeClass(p.bound).removeClass(p.top).addClass(p.fixed).addClass(p.bottom),s.onStick.call(C)},unbind:function(){A.is.bound()&&(A.debug("Removing container bound position on element"),A.remove.offset(),y.removeClass(p.bound).removeClass(p.top).removeClass(p.bottom))},unfix:function(){A.is.fixed()&&(A.debug("Removing fixed position on element"),A.remove.offset(),y.removeClass(p.fixed).removeClass(p.top).removeClass(p.bottom),s.onUnstick.call(C))},reset:function(){A.debug("Resetting elements position"),A.unbind(),A.unfix(),A.resetCSS(),A.remove.offset(),A.remove.lastScroll()},resetCSS:function(){y.css({width:"",height:""}),E.css({height:""})},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,s,t);else{if(n===r)return s[t];s[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,A,t);else{if(n===r)return A[t];A[t]=n}},debug:function(){!s.silent&&s.debug&&(s.performance?A.performance.log(arguments):(A.debug=Function.prototype.bind.call(console.info,console,s.name+":"),A.debug.apply(console,arguments)))},verbose:function(){!s.silent&&s.verbose&&s.debug&&(s.performance?A.performance.log(arguments):(A.verbose=Function.prototype.bind.call(console.info,console,s.name+":"),A.verbose.apply(console,arguments)))},error:function(){s.silent||(A.error=Function.prototype.bind.call(console.error,console,s.name+":"),A.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;s.performance&&(t=(new Date).getTime(),r=u||t,n=t-r,u=t,a.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:C,"Execution Time":n})),clearTimeout(A.performance.timer),A.performance.timer=setTimeout(A.performance.display,0)},display:function(){var t=s.name+":",n=0;u=!1,clearTimeout(A.performance.timer),e.each(a,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",o&&(t+=" '"+o+"'"),(console.group!==r||console.table!==r)&&a.length>0&&(console.groupCollapsed(t),console.table?console.table(a):e.each(a,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),a=[]}},invoke:function(t,n,i){var s=T,o,u,a;return n=n||c,i=C||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):!1;s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(h)?h.push(a):h!==r?h=[h,a]:a!==r&&(h=a),u}},l?(T===r&&A.initialize(),A.invoke(f)):(T!==r&&T.invoke("destroy"),A.initialize())}),h!==r?h:this},e.fn.sticky.settings={name:"Sticky",namespace:"sticky",silent:!1,debug:!1,verbose:!0,performance:!0,pushing:!1,context:!1,scrollContext:t,offset:0,bottomOffset:0,jitter:5,observeChanges:!1,onReposition:function(){},onScroll:function(){},onStick:function(){},onUnstick:function(){},onTop:function(){},onBottom:function(){},error:{container:"Sticky element must be inside a relative container",visible:"Element is hidden, you must call refresh after element becomes visible. Use silent setting to surpress this warning in production.",method:"The method you called is not defined.",invalidContext:"Context specified does not exist",elementSize:"Sticky element is larger than its container, cannot create sticky."},className:{bound:"bound",fixed:"fixed",supported:"native",top:"top",bottom:"bottom"}}})(jQuery,window,document);