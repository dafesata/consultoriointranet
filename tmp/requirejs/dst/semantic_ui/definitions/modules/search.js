/*!
 * # Semantic UI - Search
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

(function(e,t,n,r){t=typeof t!="undefined"&&t.Math==Math?t:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),e.fn.search=function(i){var s=e(this),o=s.selector||"",u=(new Date).getTime(),a=[],f=arguments[0],l=typeof f=="string",c=[].slice.call(arguments,1),h;return e(this).each(function(){var p=e.isPlainObject(i)?e.extend(!0,{},e.fn.search.settings,i):e.extend({},e.fn.search.settings),d=p.className,v=p.metadata,m=p.regExp,g=p.fields,y=p.selector,b=p.error,w=p.namespace,E="."+w,S=w+"-module",x=e(this),T=x.find(y.prompt),N=x.find(y.searchButton),C=x.find(y.results),k=x.find(y.result),L=x.find(y.category),A=this,O=x.data(S),M=!1,_;_={initialize:function(){_.verbose("Initializing module"),_.determine.searchFields(),_.bind.events(),_.set.type(),_.create.results(),_.instantiate()},instantiate:function(){_.verbose("Storing instance of module",_),O=_,x.data(S,_)},destroy:function(){_.verbose("Destroying instance"),x.off(E).removeData(S)},refresh:function(){_.debug("Refreshing selector cache"),T=x.find(y.prompt),N=x.find(y.searchButton),L=x.find(y.category),C=x.find(y.results),k=x.find(y.result)},refreshResults:function(){C=x.find(y.results),k=x.find(y.result)},bind:{events:function(){_.verbose("Binding events to search"),p.automatic&&(x.on(_.get.inputEvent()+E,y.prompt,_.event.input),T.attr("autocomplete","off")),x.on("focus"+E,y.prompt,_.event.focus).on("blur"+E,y.prompt,_.event.blur).on("keydown"+E,y.prompt,_.handleKeyboard).on("click"+E,y.searchButton,_.query).on("mousedown"+E,y.results,_.event.result.mousedown).on("mouseup"+E,y.results,_.event.result.mouseup).on("click"+E,y.result,_.event.result.click)}},determine:{searchFields:function(){i&&i.searchFields!==r&&(p.searchFields=i.searchFields)}},event:{input:function(){clearTimeout(_.timer),_.timer=setTimeout(_.query,p.searchDelay)},focus:function(){_.set.focus(),_.has.minimumCharacters()&&(_.query(),_.can.show()&&_.showResults())},blur:function(e){var t=n.activeElement===this,r=function(){_.cancel.query(),_.remove.focus(),_.timer=setTimeout(_.hideResults,p.hideDelay)};if(t)return;_.resultsClicked?(_.debug("Determining if user action caused search to close"),x.one("click.close"+E,y.results,function(e){if(_.is.inMessage(e)||M){T.focus();return}M=!1,!_.is.animating()&&!_.is.hidden()&&r()})):(_.debug("Input blurred without user action, closing results"),r())},result:{mousedown:function(){_.resultsClicked=!0},mouseup:function(){_.resultsClicked=!1},click:function(n){_.debug("Search result selected");var r=e(this),i=r.find(y.title).eq(0),s=r.is("a[href]")?r:r.find("a[href]").eq(0),o=s.attr("href")||!1,u=s.attr("target")||!1,a=i.html(),f=i.length>0?i.text():!1,l=_.get.results(),c=r.data(v.result)||_.get.result(f,l),h;if(e.isFunction(p.onSelect)&&p.onSelect.call(A,c,l)===!1){_.debug("Custom onSelect callback cancelled default select action"),M=!0;return}_.hideResults(),f&&_.set.value(f),o&&(_.verbose("Opening search link found in result",s),u=="_blank"||n.ctrlKey?t.open(o):t.location.href=o)}}},handleKeyboard:function(e){var t=x.find(y.result),n=x.find(y.category),r=t.index(t.filter("."+d.active)),i=t.length,s=e.which,o={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},u;s==o.escape&&(_.verbose("Escape key pressed, blurring search field"),_.trigger.blur());if(_.is.visible())if(s==o.enter){_.verbose("Enter key pressed, selecting active result");if(t.filter("."+d.active).length>0)return _.event.result.click.call(t.filter("."+d.active),e),e.preventDefault(),!1}else s==o.upArrow?(_.verbose("Up key pressed, changing active result"),u=r-1<0?r:r-1,n.removeClass(d.active),t.removeClass(d.active).eq(u).addClass(d.active).closest(n).addClass(d.active),e.preventDefault()):s==o.downArrow&&(_.verbose("Down key pressed, changing active result"),u=r+1>=i?r:r+1,n.removeClass(d.active),t.removeClass(d.active).eq(u).addClass(d.active).closest(n).addClass(d.active),e.preventDefault());else s==o.enter&&(_.verbose("Enter key pressed, executing query"),_.query(),_.set.buttonPressed(),T.one("keyup",_.remove.buttonFocus))},setup:{api:function(t){var n={debug:p.debug,on:!1,cache:!0,action:"search",urlData:{query:t},onSuccess:function(e){_.parse.response.call(A,e,t)},onAbort:function(e){},onFailure:function(){_.displayMessage(b.serverError)},onError:_.error},r;e.extend(!0,n,p.apiSettings),_.verbose("Setting up API request",n),x.api(n)}},can:{useAPI:function(){return e.fn.api!==r},show:function(){return _.is.focused()&&!_.is.visible()&&!_.is.empty()},transition:function(){return p.transition&&e.fn.transition!==r&&x.transition("is supported")}},is:{animating:function(){return C.hasClass(d.animating)},hidden:function(){return C.hasClass(d.hidden)},inMessage:function(t){return t.target&&e(t.target).closest(y.message).length>0},empty:function(){return C.html()===""},visible:function(){return C.filter(":visible").length>0},focused:function(){return T.filter(":focus").length>0}},trigger:{blur:function(){var e=n.createEvent("HTMLEvents"),t=T[0];t&&(_.verbose("Triggering native blur event"),e.initEvent("blur",!1,!1),t.dispatchEvent(e))}},get:{inputEvent:function(){var e=T[0],t=e!==r&&e.oninput!==r?"input":e!==r&&e.onpropertychange!==r?"propertychange":"keyup";return t},value:function(){return T.val()},results:function(){var e=x.data(v.results);return e},result:function(t,n){var i=["title","id"],s=!1;return t=t!==r?t:_.get.value(),n=n!==r?n:_.get.results(),p.type==="category"?(_.debug("Finding result that matches",t),e.each(n,function(n,r){if(e.isArray(r.results)){s=_.search.object(t,r.results,i)[0];if(s)return!1}})):(_.debug("Finding result in results object",t),s=_.search.object(t,n,i)[0]),s||!1}},select:{firstResult:function(){_.verbose("Selecting first result"),k.first().addClass(d.active)}},set:{focus:function(){x.addClass(d.focus)},loading:function(){x.addClass(d.loading)},value:function(e){_.verbose("Setting search input value",e),T.val(e)},type:function(e){e=e||p.type,p.type=="category"&&x.addClass(p.type)},buttonPressed:function(){N.addClass(d.pressed)}},remove:{loading:function(){x.removeClass(d.loading)},focus:function(){x.removeClass(d.focus)},buttonPressed:function(){N.removeClass(d.pressed)}},query:function(){var t=_.get.value(),n=_.read.cache(t);_.has.minimumCharacters()?(n?(_.debug("Reading result from cache",t),_.save.results(n.results),_.addResults(n.html),_.inject.id(n.results)):(_.debug("Querying for",t),e.isPlainObject(p.source)||e.isArray(p.source)?_.search.local(t):_.can.useAPI()?_.search.remote(t):_.error(b.source)),p.onSearchQuery.call(A,t)):_.hideResults()},search:{local:function(e){var t=_.search.object(e,p.content),n;_.set.loading(),_.save.results(t),_.debug("Returned local search results",t),n=_.generateResults({results:t}),_.remove.loading(),_.addResults(n),_.inject.id(t),_.write.cache(e,{html:n,results:t})},remote:function(e){x.api("is loading")&&x.api("abort"),_.setup.api(e),x.api("query")},object:function(t,n,i){var s=[],o=[],u=t.toString().replace(m.escape,"\\$&"),a=new RegExp(m.beginsWith+u,"i"),f=function(t,n){var r=e.inArray(n,s)==-1,i=e.inArray(n,o)==-1;r&&i&&t.push(n)};return n=n||p.source,i=i!==r?i:p.searchFields,e.isArray(i)||(i=[i]),n===r||n===!1?(_.error(b.source),[]):(e.each(i,function(r,i){e.each(n,function(e,n){var r=typeof n[i]=="string";r&&(n[i].search(a)!==-1?f(s,n):p.searchFullText&&_.fuzzySearch(t,n[i])&&f(o,n))})}),e.merge(s,o))}},fuzzySearch:function(e,t){var n=t.length,r=e.length;if(typeof e!="string")return!1;e=e.toLowerCase(),t=t.toLowerCase();if(r>n)return!1;if(r===n)return e===t;e:for(var i=0,s=0;i<r;i++){var o=e.charCodeAt(i);while(s<n)if(t.charCodeAt(s++)===o)continue e;return!1}return!0},parse:{response:function(e,t){var n=_.generateResults(e);_.verbose("Parsing server response",e),e!==r&&t!==r&&e[g.results]!==r&&(_.addResults(n),_.inject.id(e[g.results]),_.write.cache(t,{html:n,results:e[g.results]}),_.save.results(e[g.results]))}},cancel:{query:function(){_.can.useAPI()&&x.api("abort")}},has:{minimumCharacters:function(){var e=_.get.value(),t=e.length;return t>=p.minCharacters}},clear:{cache:function(e){var t=x.data(v.cache);e?e&&t&&t[e]&&(_.debug("Removing value from cache",e),delete t[e],x.data(v.cache,t)):(_.debug("Clearing cache",e),x.removeData(v.cache))}},read:{cache:function(e){var t=x.data(v.cache);return p.cache?(_.verbose("Checking cache for generated html for query",e),typeof t=="object"&&t[e]!==r?t[e]:!1):!1}},create:{id:function(e,t){var n=e+1,i=t+1,s,o,u;return t!==r?(o=String.fromCharCode(97+t),u=o+n,_.verbose("Creating category result id",u)):(u=n,_.verbose("Creating result id",u)),u},results:function(){C.length===0&&(C=e("<div />").addClass(d.results).appendTo(x))}},inject:{result:function(e,t,n){_.verbose("Injecting result into results");var i=n!==r?C.children().eq(n).children(y.result).eq(t):C.children(y.result).eq(t);_.verbose("Injecting results metadata",i),i.data(v.result,e)},id:function(t){_.debug("Injecting unique ids into results");var n=0,i=0;return p.type==="category"?e.each(t,function(t,s){i=0,e.each(s.results,function(e,t){var o=s.results[e];o.id===r&&(o.id=_.create.id(i,n)),_.inject.result(o,i,n),i++}),n++}):e.each(t,function(e,n){var s=t[e];s.id===r&&(s.id=_.create.id(i)),_.inject.result(s,i),i++}),t}},save:{results:function(e){_.verbose("Saving current search results to metadata",e),x.data(v.results,e)}},write:{cache:function(e,t){var n=x.data(v.cache)!==r?x.data(v.cache):{};p.cache&&(_.verbose("Writing generated html to cache",e,t),n[e]=t,x.data(v.cache,n))}},addResults:function(t){if(e.isFunction(p.onResultsAdd)&&p.onResultsAdd.call(C,t)===!1)return _.debug("onResultsAdd callback cancelled default action"),!1;t?(C.html(t),_.refreshResults(),p.selectFirstResult&&_.select.firstResult(),_.showResults()):_.hideResults()},showResults:function(){_.is.visible()||(_.can.transition()?(_.debug("Showing results with css animations"),C.transition({animation:p.transition+" in",debug:p.debug,verbose:p.verbose,duration:p.duration,queue:!0})):(_.debug("Showing results with javascript"),C.stop().fadeIn(p.duration,p.easing)),p.onResultsOpen.call(C))},hideResults:function(){_.is.visible()&&(_.can.transition()?(_.debug("Hiding results with css animations"),C.transition({animation:p.transition+" out",debug:p.debug,verbose:p.verbose,duration:p.duration,queue:!0})):(_.debug("Hiding results with javascript"),C.stop().fadeOut(p.duration,p.easing)),p.onResultsClose.call(C))},generateResults:function(t){_.debug("Generating html from response",t);var n=p.templates[p.type],r=e.isPlainObject(t[g.results])&&!e.isEmptyObject(t[g.results]),i=e.isArray(t[g.results])&&t[g.results].length>0,s="";return r||i?(p.maxResults>0&&(r?p.type=="standard"&&_.error(b.maxResults):t[g.results]=t[g.results].slice(0,p.maxResults)),e.isFunction(n)?s=n(t,g):_.error(b.noTemplate,!1)):p.showNoResults&&(s=_.displayMessage(b.noResults,"empty")),p.onResults.call(A,t),s},displayMessage:function(e,t){return t=t||"standard",_.debug("Displaying message",e,t),_.addResults(p.templates.message(e,t)),p.templates.message(e,t)},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,p,t);else{if(n===r)return p[t];p[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,_,t);else{if(n===r)return _[t];_[t]=n}},debug:function(){!p.silent&&p.debug&&(p.performance?_.performance.log(arguments):(_.debug=Function.prototype.bind.call(console.info,console,p.name+":"),_.debug.apply(console,arguments)))},verbose:function(){!p.silent&&p.verbose&&p.debug&&(p.performance?_.performance.log(arguments):(_.verbose=Function.prototype.bind.call(console.info,console,p.name+":"),_.verbose.apply(console,arguments)))},error:function(){p.silent||(_.error=Function.prototype.bind.call(console.error,console,p.name+":"),_.error.apply(console,arguments))},performance:{log:function(e){var t,n,r;p.performance&&(t=(new Date).getTime(),r=u||t,n=t-r,u=t,a.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:A,"Execution Time":n})),clearTimeout(_.performance.timer),_.performance.timer=setTimeout(_.performance.display,500)},display:function(){var t=p.name+":",n=0;u=!1,clearTimeout(_.performance.timer),e.each(a,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",o&&(t+=" '"+o+"'"),s.length>1&&(t+=" ("+s.length+")"),(console.group!==r||console.table!==r)&&a.length>0&&(console.groupCollapsed(t),console.table?console.table(a):e.each(a,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),a=[]}},invoke:function(t,n,i){var s=O,o,u,a;return n=n||c,i=A||i,typeof t=="string"&&s!==r&&(t=t.split(/[\. ]/),o=t.length-1,e.each(t,function(n,i){var a=n!=o?i+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(s[a])&&n!=o)s=s[a];else{if(s[a]!==r)return u=s[a],!1;if(!e.isPlainObject(s[i])||n==o)return s[i]!==r?(u=s[i],!1):!1;s=s[i]}})),e.isFunction(u)?a=u.apply(i,n):u!==r&&(a=u),e.isArray(h)?h.push(a):h!==r?h=[h,a]:a!==r&&(h=a),u}},l?(O===r&&_.initialize(),_.invoke(f)):(O!==r&&O.invoke("destroy"),_.initialize())}),h!==r?h:this},e.fn.search.settings={name:"Search",namespace:"search",silent:!1,debug:!1,verbose:!1,performance:!0,type:"standard",minCharacters:1,selectFirstResult:!1,apiSettings:!1,source:!1,searchFields:["title","description"],displayField:"",searchFullText:!0,automatic:!0,hideDelay:0,searchDelay:200,maxResults:7,cache:!0,showNoResults:!0,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:!1,onResultsAdd:!1,onSearchQuery:function(e){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",message:".results > .message",category:".category",result:".result",title:".title, .name"},templates:{escape:function(e){var t=/[&<>"'`]/g,n=/[&<>"'`]/,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=function(e){return r[e]};return n.test(e)?e.replace(t,i):e},message:function(e,t){var n="";return e!==r&&t!==r&&(n+='<div class="message '+t+'">',t=="empty"?n+='<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':n+=' <div class="description">'+e+"</div>",n+="</div>"),n},category:function(t,n){var i="",s=e.fn.search.settings.templates.escape;return t[n.categoryResults]!==r?(e.each(t[n.categoryResults],function(t,s){s[n.results]!==r&&s.results.length>0&&(i+='<div class="category">',s[n.categoryName]!==r&&(i+='<div class="name">'+s[n.categoryName]+"</div>"),e.each(s.results,function(e,t){t[n.url]?i+='<a class="result" href="'+t[n.url]+'">':i+='<a class="result">',t[n.image]!==r&&(i+='<div class="image"> <img src="'+t[n.image]+'">'+"</div>"),i+='<div class="content">',t[n.price]!==r&&(i+='<div class="price">'+t[n.price]+"</div>"),t[n.title]!==r&&(i+='<div class="title">'+t[n.title]+"</div>"),t[n.description]!==r&&(i+='<div class="description">'+t[n.description]+"</div>"),i+="</div>",i+="</a>"}),i+="</div>")}),t[n.action]&&(i+='<a href="'+t[n.action][n.actionURL]+'" class="action">'+t[n.action][n.actionText]+"</a>"),i):!1},standard:function(t,n){var i="";return t[n.results]!==r?(e.each(t[n.results],function(e,t){t[n.url]?i+='<a class="result" href="'+t[n.url]+'">':i+='<a class="result">',t[n.image]!==r&&(i+='<div class="image"> <img src="'+t[n.image]+'">'+"</div>"),i+='<div class="content">',t[n.price]!==r&&(i+='<div class="price">'+t[n.price]+"</div>"),t[n.title]!==r&&(i+='<div class="title">'+t[n.title]+"</div>"),t[n.description]!==r&&(i+='<div class="description">'+t[n.description]+"</div>"),i+="</div>",i+="</a>"}),t[n.action]&&(i+='<a href="'+t[n.action][n.actionURL]+'" class="action">'+t[n.action][n.actionText]+"</a>"),i):!1}}}})(jQuery,window,document);